% Component List

% STATE OF STORY DESCRIPTION
%  The state of the story is determined by both the "context" attribute held in
%  the story and by certain variables which are determined when it's time to
%  generate a new component. These variables could include:
%  - The existence and nature of the palette entries
%  - The alleigance of the current location with either the PC's faction
%    or the palette enemy faction

% The palette entries are:
%	STAT_XRP_EnemyChar = 1;			{ E: }
%	STAT_XRP_EnemyFac = 2;			{ F: }
%	STAT_XRP_PCFac = 3;			{ P: }
%	STAT_XRP_PlotStateNPC = 4;		{ M: }
%	STAT_XRP_TargetNPC = 5;			{ T: }
%	STAT_XRP_ComponentScene = 6;		{ S: }
%	STAT_XRP_EpisodeScene = 7;		{ L: }
%	STAT_XRP_TargetItem = 8;		{ I: }

Plot
	name <Level That House>
	size 1
	desc <The meeting place is attacked by mecha!>
	requires <#A +Tpt T:++ S:++ S:meta>

	% P1 = Initialization Counter

	% E1 is the scene where this will take place
	% E2 is the NPC the PC wants to talk to
	% E3 is the scene outside the meeting area
	% E4 is a public building, if the player chooses to sneak
	element1 <Grab 6>
	element2 <Grab 5>
	Place2 <1 (Citizens) pass ally>
	element3 <Scene Urban !Near -7>
	element4 <Scene Building Public !Near -7 !Okay 2>

	% SubPlot1 contains the ambush battle
	% SubPlot2 contains the victory, if the PC defeats the enemies
	SubPlot1 <*CS_AmbushEncounter 3>
	SubPlot2 <*CS_ThanksForRescue 2>

	start <if= PlotStatus 0 ifNPCDead %2% LoseComp 0 .loss>
	.loss <+T-- +F-->

	% Needed Scripts
	.%id1%_%plotid%_GoWin <ifNPCOK %2% else GoJustEnd Alert 4 StoryNote 2 SetPlotStatus %id2%>
	.%id1%_%plotid%_GoLose <ifNPCOK %2% else GoJustEnd Alert 3 StoryNote 1 DeleteNPC %2% Goto GoJustEnd>
	GoJustEnd <LoseComp 0 .loss>
	.loss <+T-- +Pun>
	Msg1 <You couldn't protect %name2% from a mecha attack.>
	Msg2 <You rescued %name2% from a mecha attack against %name1%.>
	Msg3 <%name1% is blasted by the mecha, killing those trapped inside.>
	Msg4 <You have defended %name2% from the mecha attack.>

	sub
		MetaScene 1
		% L1 = Bombing started
		% L2 = Bomb counter

		BoxMap
		MapWidth 15
		MapHeight 15

		special <AddExit>

		sub
			Team 1

			Team 2
			name <Citizens>
			setally 1
			Passive

			room
			name <Dance Floor>
			desig <EntranceGrid>
		end

		Persona 2
		special <UNLISTED>
		greeting <if= PlotStatus %id1% else GoCheckFirstMeeting EndChat Say 1>
		GoCheckFirstMeeting <if= PlotStatus 0 else GoChat Goto GoGreet>
		GoSetAttack <StoryNote 2 SetPlotStatus %id1%>
		GoChat <NewChat SayAnything>
		*GoGreet <*ProtectCheckIn GoMiisionInfo>
		GoMiisionInfo <NewChat Say 3 AddChat 1 AddChat 2 Goto GoSetAttack>
		result1 <NewChat Say 4>
		result2 <NewChat Say 5 AddChat 3 AddChat 4>
		result3 <EndChat Say 6 AddReact d10 Print 7 XPV 100 Exit %4% SeekGate %3% MoveNPC %2% %4% StoryNote 8 SetPlotStatus %id2%>
		result4 <Goto result1>
		Msg1 <We can't leave here while those mecha are outside...>
		Msg2 <You found %name2% trapped in %name1% by hostile mecha.>
		Msg3_10 <I can't leave this building. There are people outside, with mecha... I'm certain that \PERSONA &EnemyNPC sent them.>
		CMsg3_10 <ifNPCOK &EnemyNPC Accept>
		Msg3_20 <I can't leave this building. There are people outside, with mecha... The second I show my face in public I'll be dead.>
		CMsg3_20 <ifNPCDead &EnemyNPC Accept>
		Msg4 <Good luck.>
		Msg5 <Are you sure? That sounds awfully dangerous...>
		Msg6 <I'll believe in you. Let's go.>
		Msg7 <You sneak %name2% out of the building, and the two of you proceed to %name4%.>
		Msg8 <You sneaked %name2% away to safety.>
		Prompt1 <I can handle the mecha.>
		Prompt2 <Why don't we just sneak past them?>
		CPrompt2 <IfStealth HardSkillTar StoryDL Accept>
		Prompt3 <Trust me. I know what I'm doing.>
		Prompt4 <You could be right. I'll just fight the mecha.>
	end

Plot
	name <Convention Press Conference>
	desc <This convention is about to feature a press conference.>
	requires <#A +Tsh +Fcc>

	% E1 is the scene where the conference will take place
	% E2 is a local scene; natural home to E4
	% E3 is the character doing the talking
	Element1 <Grab 6>
	Element2 <Scene !Near -7 !Okay -3 Public>
	Element3 <NewNPC 2 2>
	Place3 <2>

	% V1 = Initialization Counter
	update <if= V1 0 MoveNPC %3% %1% V= 1 1>
	start <if= PlotStatus 0 if= SceneID %1% Alert 1 SMemo 2 SetPlotStatus %id1%>

	Msg1 <At the convention hall, %name3% appears to be just finishing up a speech.>
	Msg2 <At %name1%, %name3% just gave a speech about something.>

	%% SubPlot1 is the press conference
	SubPlot1 <*CS_PressConference 1 3>

	sub
		STC MS_PRESENTATION
		SetID 1
	end

Plot
	name <Rescue Reward>
	desc <The PC has to speak to a person he just rescued.>
	requires <#A +Tgt +Frt>

	% E1 is the scene where the meeting will take place.
	% E2 is the person who was rescued.
	Element1 <Grab 6>
	Element2 <Grab 5>
	Place2 <1 (Citizens) pass>

	% All the update does is start the rescue reward going...
	update <if= PlotStatus 0 SetPlotStatus %id1%>

	% The subplot contains the reaction/reward.
	SubPlot1 <*CS_ThanksForRescue 2>

	sub
		STC MS_CAFE
		SetID 1
	end

Plot
	name <Locate Target NPC: Perm>
	desc <The PC needs to find an NPC for some reason, but no scene exists.>
	requires <#A +Tpt S:-->
	Size 2

	% E1 is the character being sought.
	% E2 is the character who knows where E1 is.
	% E3 is a scene for the meeting
	Element1 <Grab 5>
	Place1 </>
	Element2 <Character !Near -7 !Okay 1>
	Element3 <Scene !Near -7 Building Public !Okay 1>

	start <if= PlotStatus 0 ifNPCDead %2% NegateComp 0 na>

	sub
		Persona 2
		rumor <%name2% has seen %name1% .>
		*greeting <*LookingForNPC %1% GoSuccess GoFailure>
		GoSuccess <NewChat Say 1 SMemo 2 WinComp %3% .win>
		.win <>
		*GoFailure <*BrushOff&Questioning>
		Msg1 <As far as I know, %name1% is now at %name3%. I hope \SPR %1% isn't in any trouble.>
		Msg2 <%name2% told you that %name1% was at %name3%.>
	end

Plot
	name <Locate Target NPC: Meta>
	desc <The PC needs to find an NPC for some reason, but no scene exists.>
	requires <#A +Tpt S:-->
	Size 2

	% E1 is the character being sought.
	% E2 is the character who knows where E1 is.
	% E3 is a scene for the meeting
	Element1 <Grab 5>
	Place1 </>
	Element2 <Character !Near -7 !Okay 1>
	Element3 <MetaScene !Near -7 *Building NeverFail>

	start <if= PlotStatus 0 ifNPCDead %2% NegateComp 0 na>

	sub
		Persona 2
		rumor <%name2% has seen %name1% .>
		*greeting <*LookingForNPC %1% GoSuccess GoFailure>
		GoSuccess <NewChat Say 1 SMemo 2 WinComp %3% .win>
		.win <>
		*GoFailure <*BrushOff&Questioning>
		Msg1 <As far as I know, %name1% is now at %name3%. I hope \SPR %1% isn't in any trouble.>
		Msg2 <%name2% told you that %name1% was at %name3%.>
	end

Plot
	name <Degenerate Lookfer: Perm>
	desc <The PC needs to find an NPC for some reason. After speaking with an NPC, the search changes to +Tgt.>
	requires <#A +Tlt>
	Size 2

	% E1 is the character being sought.
	% E2 is the character who knows where E1 is.
	% E3 is a scene for the meeting
	Element1 <Grab 5>
	Element2 <Character !Near -7 !Okay 1>
	Element3 <Scene !Near -7 Building Public !Okay 1>

	% P%id%01 = Initialization Counter

	% All the update does is freeze the target...
	update <if= PlotStatus 0 if= P%id%01 0 P= %id%01 1 FreezeNPC %1%>
	start <if= PlotStatus 0 ifNPCDead %2% NegateComp 0 na>

	sub
		Persona 2
		rumor <%name2% knows where %name1% is.>
		*greeting <*LookingForNPC %1% GoSuccess GoFailure>
		GoSuccess <NewChat Say 1 SMemo 2 WinComp %3% .win>
		.win <+Tgt>
		*GoFailure <*BrushOff&Questioning>
		Msg1 <The last time I saw \OPR %1% , %name1% was going to %name3%. That's where you should probably check.>
		Msg2 <%name2% told you that %name1% was at %name3%.>
	end

Plot
	name <Degenerate Lookfer: Meta>
	desc <The PC needs to find an NPC for some reason. After speaking with an NPC, the search changes to +Tgt.>
	requires <#A +Tlt>
	Size 2

	% E1 is the character being sought.
	% E2 is the character who knows where E1 is.
	% E3 is a scene for the meeting
	Element1 <Grab 5>
	Element2 <Character !Near -7 !Okay 1>
	Element3 <MetaScene !Near -7 *Building NeverFail>

	% P%id%01 = Initialization Counter

	% All the update does is freeze the target...
	update <if= PlotStatus 0 if= P%id%01 0 P= %id%01 1 FreezeNPC %1%>
	start <if= PlotStatus 0 ifNPCDead %2% NegateComp 0 na>

	sub
		Persona 2
		rumor <%name2% knows where %name1% is.>
		*greeting <*LookingForNPC %1% GoSuccess GoFailure>
		GoSuccess <NewChat Say 1 SMemo 2 WinComp %3% .win>
		.win <+Tgt>
		*GoFailure <*BrushOff&Questioning>
		Msg1 <The last time I saw \OPR %1% , %name1% was going to %name3%. That's where you should probably check.>
		Msg2 <%name2% told you that %name1% was at %name3%.>
	end

Plot
	name <Basic Manhunt>
	desc <You're on the trail of a criminal.>
	requires <#A +Tht>

	% E1 is the character being sought.
	Element1 <Grab 5>

	% SubPlot1 is the hideout hider
	%  This subplot should lead on to the conclusion
	SubPlot1 <*CS_Manhunt_Search 1>

	% All the update does is start the manhunt going...
	update <if= PlotStatus 0 SetPlotStatus %id1%>



Plot
	name <Basic Challenge>
	desc <You're going to challenge some guy.>
	requires <#A +Tgt +Fch T:++ Common>

	% E1 is the scene where the meeting will take place.
	% E2 is the friend being met.
	% E3 is a location for the duel.
	Element1 <Grab 6>
	Element2 <Grab 5>
	Place2 <1 (Citizens) pass>
	Element3 <Scene Environs !Near -7>

	% SubPlot1 is the duel itself
	% SubPlot2 is the path if the PC wins the duel
	% SubPlot3 is the path if the PC loses the duel
	SubPlot1 <*CS_Duel 2 1 3>
	SubPlot2 <*CS_WinDuelVs 2>
	SubPlot3 <*CS_LoseDuelVs 2>

	% As long as we're still at the first phase, the NPC's death will end the plot.
	start <if= PlotStatus 0 ifNPCDead %2% LoseComp 0 .changes>
	.changes <+T-- +F-->

	% V1 = Initialization Counter
	update <if= v1 0 V= 1 1 NPCLevel %2% StoryDL>

	% Branch activators
	.%id1%_%plotid%_GoWin <ifNPCOK %2% else GoE2Died SMemo 1 SetPlotStatus %id2%>
	.%id1%_%plotid%_GoLose <SMemo 2 SetPlotStatus %id3%>
	GoE2Died <SMemo 0 WinComp 0 .changes>

	Msg1 <You bested %name2% in a duel; \SPR %2% is waiting for you at %name1%.>
	Msg2 <You were defeated by %name2% in a duel; \SPR %2% is waiting for you at %name1%.>

	sub
		Persona 2
		greeting <if= PlotStatus 0 else GoChat Goto GoFirstTime>
		*GoChat <*MISC_CHATTER>
		*GoFirstTime <*PCChallengeNPC GoMakeChallenge GoWussOut>
		GoMakeChallenge <StoryNote 1 SetPlotStatus %id1% Goto GoAcceptChallenge>
		*GoAcceptChallenge <*IAcceptYourChallenge %3%>
		*GoWussOut <*GodImBored>
		Msg1 <You challenged %name2% to a duel in %name3%.>

		STC MS_CAFE
		SetID 1
	end

Plot
	name <Lead: Media>
	desc <A media personality will call about something.>
	requires <#A +T-- C:MEDIA>

	% E1 is the scene where this component will take place
	% E2 is the NPC that the PC will speak with
	element1 <Scene Building Public !Near -7>
	element2 <Character !Near 1 MEDIA NeverFail>
	NeverFail2 <Journalist>
	Place2 <1 (Citizens) pass>

	% All this plot does is move the NPC, send an email,
	% and activate the mission subplot
	update <if= PlotStatus 0  EMail 1  SetPlotStatus %id1%>

	%% SubPlot1 is the mission to be offered
	SubPlot1 <*CS_Conversation 2>

	Msg1_1  <%name2%@ \NARRATIVE 7 :// I have a lead for you, \PC . Come meet me at %name1%.>
	Msg1_2  <%name2%@ \NARRATIVE 7 :// Looking for a story? Come see me at %name1%.>
	Msg1_3  <%name2%@ \NARRATIVE 7 :// Hey, let's do lunch at %name1%.>
	Msg1_4  <%name2%@ \NARRATIVE 7 :// I've got an angle to pitch to you. Come see me at %name1%.>
	Msg1_5  <%name2%@ \NARRATIVE 7 :// Have you tried %name1% yet? Meet me there, it's fabulous.>

Plot
	name <Basic Job Offer>
	desc <The PC has to see someone about a job; here it is!>
	requires <#A +Tgt +Fmi Common>

	% E1 is the scene where this component will take place
	% E2 is the NPC that the PC will speak with
	element1 <Grab 6>
	element2 <Grab 5>
	Place2 <1 (Citizens) pass>

	% All this plot does is move the NPC and activate the mission subplot
	update <if= PlotStatus 0 SetPlotStatus %id1%>

	%% SubPlot1 is the mission to be offered
	SubPlot1 <*CS_GiveMission 2>

	sub
		STC MS_OFFICE
		SetID 1
	end

Plot
	name <Basic Conversation>
	desc <The PC has to talk with someone; here it is!>
	requires <#A +Tgt (+F--|+Fin) Common>

	% E1 is the scene where this component will take place
	% E2 is the NPC that the PC will speak with
	element1 <Grab 6>
	element2 <Grab 5>
	Place2 <1 (Citizens) pass>

	% All this plot does is move the NPC and activate the conversation subplot
	update <if= PlotStatus 0 SetPlotStatus %id1%>

	%% SubPlot1 is the conversation to be had
	SubPlot1 <*CS_Conversation 2>

	sub
		STC MS_CAFE
		SetID 1
	end

Plot
	name <Basic Friend Contact>
	desc <The PC's friend will call about something.>
	requires <#A +T-->

	% E1 is the scene where this component will take place
	% E2 is the NPC that the PC will speak with
	element1 <Scene Building Public !Near -7>
	element2 <Character !Near -7 !Okay 1 Friend>
	Place2 <1 (Citizens) pass>

	% All this plot does is move the NPC, send an email,
	% and activate the mission subplot
	update <if= PlotStatus 0  EMail 1  SetPlotStatus %id1%>

	%% SubPlot1 is the mission to be offered
	SubPlot1 <*CS_Conversation 2>

	Msg1_1  <%name2%@ \NARRATIVE 7 :// Hey \PC , when you have the time come see me at %name1%>
	Msg1_2  <%name2%@ \NARRATIVE 7 :// I'll be at %name1% for a while. Drop by and we can have a chat.>
	Msg1_3  <%name2%@ \NARRATIVE 7 :// If you're not busy, I'd like to meet with you at %name1%.>
	Msg1_4  <%name2%@ \NARRATIVE 7 :// There are things we need to discuss. Meet me at %name1%.>
	Msg1_5  <%name2%@ \NARRATIVE 7 :// \PC , come meet me at %name1%. I'll be waiting there.>


Plot
	name <Basic Friendly Mission>
	desc <The PC will be offered a job by a faction member.>
	requires <#A +T-- P:++ -P:ENEMY>

	% E1 is the scene where this component will take place
	% E2 is the NPC that the PC will speak with
	element1 <Scene Building Public !Okay -3 !Near -7>
	element2 <Character !Near -7 !Comrade -3>
	Place2 <1 (Citizens) pass>

	% All this plot does is move the NPC, send an email,
	% and activate the mission subplot
	update <if= PlotStatus 0  EMail 1  SetPlotStatus %id1%>

	%% SubPlot1 is the mission to be offered
	SubPlot1 <*CS_GiveMission 2>

	Msg1_1  <%name2%@ \NARRATIVE 7 // I've got a job for you. Report to %name1% as soon as possible.>
	Msg1_2  <%name2%@ \NARRATIVE 7 :// You have some work from \NARRATIVE 3 . I'll be waiting for you here at %name1%.>
	Msg1_3  <%name2%@ \NARRATIVE 7 :// I have a mission for you from \NARRATIVE 3 . Call me, or come to %name1%.>
	Msg1_4  <%name2%@ \NARRATIVE 7 :// \PC - I've got some work for you to do. Come to %name1% for the briefing.>
	Msg1_5  <%name2%@ \NARRATIVE 7 :// Your presence is required in %name1%.>


