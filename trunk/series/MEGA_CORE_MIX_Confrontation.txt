%%
%% *:CS_MIX_Confrontation Content
%%     &NoDerailment   May not derail the plot; just straight combat please!
%%
%%  Y'know how to get more randomness in your random story generator? Mix things
%%  up a bit.
%%
%%  The core story enemy is doing something. The PC is trying to prevent it.
%%  Now, the two of them are gonna fight. It doesn't really matter what kind of
%%  fight we're dealing with- whatever's going on, we can work in some character
%%  development.
%%
%%  At the start of combat, this subplot will be activated.
%%  The combat encounter can then send the following triggers, both of which
%%  must have scripts in this subplot:
%%
%%    .%id%_%plotid%_GoCombatWin
%%    .%id%_%plotid%_GoCombatLoss
%%
%%  The confrontation will send back the following triggers:
%%
%%    .%id%_%plotid%_GoWin
%%    .%id%_%plotid%_GoLoss
%%
%%  The combat encounter requires the following teams:
%%
%%    Enemies
%%    EnemyNPC
%%
%%  Note that this subplot may completely derail combat by issuing a RETURN
%%  command. The parent subplot must wait for one of the above responses before
%%  concluding.
%%
%%  An encounter to which a confrontation has been attached automatically
%%  becomes a MAIN COURSE.
%%
%% PARAM1: The Enemy NPC, who should be in the encounter scene + ready to fight
%% PARAM2: The outdoors scene where the encounter is
%%

Content
	name <Until Someone Loses an Eye>
	requires <*:CS_MIX_Confrontation 1:M.com (1:A.sr_|1:A.ant|1:A.equ) -!Ne>
	desc <It was all fun and games before, now it's getting serious.>
	changes <E:A>
	results <E:A.env>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%02  ifNPCOK %1% SetXXRAttitude %1% XXR_A_EnviesPC  Monologue %1% %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  History %id%03>

	Msg%id%01 <Hmph... Your skills have really improved, \PC . Looks like I'm going to have to work harder to beat you.>
	Msg%id%01_1 <>
	CMsg%id%01_1 <ifNPCHeroic Accept>
	Msg%id%01_2 <>
	CMsg%id%01_2 <ifNPCVillainous Accept>
	Msg%id%02 <You defeated %name1%, who seemed upset about it.>
	Msg%id%03 <You were defeated by %name1%.>

	sub
		Persona 1
		%% An entirely generic battle challenge.
		special <UNLISTED>
		greeting <if= PlotStatus %plotid% %id% else %pop% Goto .%id%_GoGreet>
		*.%id%_GoGreet <*BattleChallenge .%id%_GoThemeExpo na>
		*.%id%_GoThemeExpo <*THEME_EXPO&Enemy na>
	end


Content
	name <Wealth is a Phallic Symbol>
	requires <*:CS_MIX_Confrontation 1:M.mer (1:A.---|1:A.sr_|1:A.ant) ~E:CORPO ~E:TRADE ~E:POLIT ~E:MEDIA ~F:CORPO -!Ne>
	desc <Before fighting, the NPC will compare earnings with the PC.>
	changes <E:A>
	results <E:A.equ E:A.env>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  History %id%02>

	Msg%id%01 <You defeated %name1%.>
	Msg%id%02 <You were defeated by %name1%.>

	sub
		Persona 1
		special <UNLISTED NOESCAPE>
		% V%id%01 = Enemy Earning Counter
		greeting <if= PlotStatus %plotid% %id% else %pop% Goto .%id%_GoGreet>
		*.%id%_GoGreet <*BattleChallenge .%id%_GoAsk na>
		.%id%_GoAsk <EndChat Say %id%01 AddChat %id%01 AddChat %id%02 History %id%02>
		*.%id%_GoThemeExpo <*THEME_EXPO&Enemy na>
		result%id%01 <V= %id%01 StoryDL V+ %id%01 d10 AddSociable d10  ifG PCRenown v%id%01 else .%id%_GoR1Fail EndChat Say %id%03 AddChat %id%03  SetXXRAttitude %1% XXR_A_EnviesPC History %id%04>
		.%id%_GoR1Fail <EndChat Say %id%05 AddChat %id%03  SetXXRAttitude %1% XXR_A_IsEqual>
		result%id%02 <EndChat Say %id%06 AddChat %id%03  ifG PCRenown StoryDL else .%id%_GoR2Fail NPCLevel %1% PCRenown SetXXRAttitude %1% XXR_A_EnviesPC>
		.%id%_GoR2Fail <SetXXRAttitude %1% XXR_A_IsEqual>
		result%id%03 <Goto .%id%_GoThemeExpo>
		Msg%id%01 <Say, \PC , before we start this battle I was just wondering... how much do you make for an average mission?>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCHeroic Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCVillainous Accept>
		Msg%id%01_12 <>
		CMsg%id%01_12 <ifNPCAttitude %1% XXR_A_IsSenior Accept>
		Msg%id%01_13 <>
		CMsg%id%01_13 <ifNPCAttitude %1% XXR_A_Antagonistic Accept>
		Msg%id%02 <Before fighting, %name1% asked about your wages.>
		Msg%id%03 <What!? That's ridiculous... you can't possibly be worth that kind of money.>
		Msg%id%04 <%name1% was jealous over how much you make.>
		Msg%id%05 <That sounds about right. Thanks.>
		Msg%id%06 <If you know how much someone earns, that's a pretty good indication of how skilled they are. Of course there are other ways to tell.>
		Prompt%id%01 <I make around $ \VAL Reward PCRenown 120 per battle.>
		Prompt%id%01_1 <I get about $ \VAL Reward PCRenown 120 a mission.>
		Prompt%id%02 <None of your business, \CHATNPC .>
		Prompt%id%02_1 <This is a weird time for a question like that...>
		Prompt%id%03 <[Continue]>
	end

Content
	name <You Are The Enemy Of Capitalism!!!>
	requires <*:CS_MIX_Confrontation 1:M.mer (1:A.---|1:A.nme|1:A.jr_) ~E:CORPO ~E:TRADE ~F:CRIME ~F:CORPO>
	desc <The NPC is fed up of the PC's interference.>
	changes <E:A>
	results <E:A.ant E:A.equ>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	% P%id%02 = E1's proposal
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  if= P%id%02 0  History %id%02>

	Msg%id%01 <You defeated %name1%.>
	Msg%id%02 <You were defeated by %name1%.>

	sub
		Persona 1
		special <UNLISTED NOESCAPE>
		greeting <if= PlotStatus %plotid% %id% else %pop% EndChat ifNPCCheerful else .%id%_GoNoCheer ifG React 0 else .%id%_GoNoCheer Say %id%03 AddChat %id%02 AddChat %id%03 if= v%id%01 0 V= %id%01 1 History %id%04>
		.%id%_GoNoCheer <Say %id%01 AddChat %id%01 if= v%id%01 0 V= %id%01 1 SetXXRAttitude %1% XXR_A_Antagonistic History %id%02>
		*.%id%_GoThemeExpo <*THEME_EXPO&Enemy na>
		result%id%01 <Goto .%id%_GoThemeExpo>
		result%id%02 <EndChat Say %id%05 CashPrize Reward StoryDL 100 Retreat 1  AddEasygoing 10  AddSociable -10  AddLawful -2  LoseRenown  SetXXRAttitude %1% XXR_A_IsEqual  History %id%06 P= %id%02 1>
		result%id%03 <EndChat Say %id%07 AddChat %id%04 if= v%id%01 0 V= %id%01 1 SetXXRAttitude %1% XXR_A_Antagonistic>
		result%id%04 <Goto .%id%_GoThemeExpo>
		Msg%id%01 <Why can't I ever have a mission go smoothly, without some jerk butting \PPR 0 nose in where it doesn't belong!? It's your fault that I'm broke, \PC ... and I'm gonna make you pay for it.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCHeroic Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCVillainous Accept>
		Msg%id%01_11 <>
		CMsg%id%01_11 <ifNPCAttitude %1% XXR_A_IsJunior Accept>
		Msg%id%01_12 <>
		CMsg%id%01_12 <ifNPCAttitude %1% XXR_A_NeverMet Accept>
		Msg%id%02 <%name1% blamed you for \PPR %1% current lack of money.>
		Msg%id%03 <Just what I need, it's \PC ... I always seem to lose money when you're around. Why don't we make a deal? I'll pay you $ \VAL Reward StoryDL 100 to throw this mission.>
		Msg%id%03_1 <>
		CMsg%id%03_1 <ifNPCHeroic Accept>
		Msg%id%03_2 <>
		CMsg%id%03_2 <ifNPCVillainous Accept>
		Msg%id%03_11 <>
		CMsg%id%03_11 <ifNPCAttitude %1% XXR_A_IsJunior Accept>
		Msg%id%03_12 <>
		CMsg%id%03_12 <ifNPCAttitude %1% XXR_A_NeverMet Accept>
		Msg%id%04 <%name1% offered you a bribe to just go away.>
		Msg%id%05 <Ha, I knew you were a money-grubbing scoundrel, too! Now we've both made a profit. See you around, \PC .>
		Msg%id%06 <You accepted the bribe.>
		Msg%id%07 <What's the matter, my money's not good enough for you!? I should have known that you were one of those serious cavaliers... guess there's only one thing left for us to do.>
		Msg%id%07_1 <>
		CMsg%id%07_1 <ifNPCHeroic Accept>
		Msg%id%07_2 <>
		CMsg%id%07_2 <ifNPCVillainous Accept>
		Msg%id%07_11 <>
		CMsg%id%07_11 <ifNPCAttitude %1% XXR_A_IsJunior Accept>
		Msg%id%07_12 <>
		CMsg%id%07_12 <ifNPCAttitude %1% XXR_A_NeverMet Accept>
		Prompt%id%01 <Don't blame me for your failures.>
		Prompt%id%01_1 <Yeah, you have a job to do, and so do I.>
		Prompt%id%01_2 <Stop whining. Let's see how you fight.>
		Prompt%id%02 <Earn money for not working? I'm all for that.>
		Prompt%id%02_1 <Sounds like a fair deal. Let's do it.>
		Prompt%id%03 <No deal, \CHATNPC .>
		Prompt%id%03_1 <I don't work that cheap, \CHATNPC .>
		Prompt%id%04 <[Continue]>
	end


Content
	name <You're Cutting Into My Profits>
	requires <*:CS_MIX_Confrontation 1:M.--- (1:A.---|1:A.jr_|1:A.sr_|1:A.ant|1:A.equ|1:A.pch) ~E:THIEF ~E:CORPO ~E:TRADE ~F:CRIME ~F:CORPO -F:POLIC>
	desc <The NPC will accuse the PC of cutting into their profits, thereby setting attitude as Mercenary.>
	changes <E:M>
	results <E:M.mer>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  History %id%02>

	Msg%id%01 <You defeated %name1%.>
	Msg%id%02 <You were defeated by %name1%.>

	sub
		Persona 1
		special <UNLISTED>
		greeting <if= PlotStatus %plotid% %id% else %pop% EndChat Say %id%01 AddChat %id%01 AddChat %id%02 if= v%id%01 0 V= %id%01 1 SetXXRMotivation %1% XXR_M_Mercenary History %id%02>
		*.%id%_GoThemeExpo <*THEME_EXPO&Enemy na>
		result%id%01 <AddCheerful  d10   Goto .%id%_GoThemeExpo>
		result%id%02 <Goto .%id%_GoThemeExpo>
		Msg%id%01 <You need to stop interfering with my missions, \PC ... it's really starting to cut into my profits.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCHeroic Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCVillainous Accept>
		Msg%id%01_11 <Aw, blazes... \PC , could you just let me do one mission in peace? All this fighting is messing up my profits.>
		CMsg%id%01_11 <ifNPCAttitude %1% XXR_A_IsJunior Accept>
		Msg%id%01_12 <Hm, what's this? Men, remove this distraction... \PC , your presence here is cutting into my profit.>
		CMsg%id%01_12 <ifNPCAttitude %1% XXR_A_IsSenior Accept>
		Msg%id%01_13 <\PC , why do you always show up at the worst possible times!? I won't let you ruin this mission... your presence here is cutting into my profit.>
		CMsg%id%01_13 <ifNPCAttitude %1% XXR_A_Antagonistic Accept>
		Msg%id%01_14 <I'm in no mood to duel today, \PC . Profit is on the line and your presence is likely to screw it up.>
		CMsg%id%01_14 <ifNPCAttitude %1% XXR_A_IsEqual Accept>
		Msg%id%02 <%name1% accused you of cutting into \PPR %1% profits.>
		Prompt%id%01 <On the plus side, it's really helping mine!>
		Prompt%id%01_1 <Don't be glum. Think of the fun we'll have!>
		Prompt%id%01_2 <Don't worry, some mecha combat will cheer you right up!>
		Prompt%id%02 <I don't care about your profits.>
		Prompt%id%02_1 <You won't need money where you're going, \CHATNPC .>
		Prompt%id%02_2 <Is money all you care about?>
	end

Content
	name <Nemesis Application>
	requires <*:CS_MIX_Confrontation 1:A.nme (1:M.---|1:M.pro|1:M.com|1:M.nih) ~1:MILIT ~1:ADVEN ~F:POLIT>
	desc <This enemy won't bother to fight, but will just sit back and evaluate your battle prowress.>
	changes <E:A>
	results <E:A.sr_>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%02  ifNPCOK %1%  Monologue %1% %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  History %id%03>

	Msg%id%01 <Impressive. Your technique is primitive, but shows some potential. I'll concede the field of battle today... it would be a waste to kill such an interesting new rival.>
	Msg%id%01_1 <Clearly I underestimated you. I concede the field of battle today... next time we meet, I'll give you a demonstration of my own.>
	CMsg%id%01_1 <ifNPCHeroic Accept>
	Msg%id%01_2 <You're better than I thought. Don't worry, I don't intend to finish you off, not yet... It may be interesting to play with you a bit before then.>
	CMsg%id%01_2 <ifNPCVillainous Accept>
	Msg%id%02 <You defeated %name1%'s forces.>
	Msg%id%03 <You were defeated by %name1%'s forces.>

	sub
		Persona 1
		special <UNLISTED NOESCAPE>
		% This NPC will flee the board, and instead send extra henchmen after you.
		% V%id%01 = First time counter
		greeting <if= PlotStatus %plotid% %id% else %pop% EndChat Say %id%01 AddChat %id%01 if= V%id%01 0 V= %id%01 1 SetXXRAttitude %1% XXR_A_IsSenior Retreat EnemyNPCTeam WMecha EnemiesTeam StoryDL 100>
		result%id%01 <EndChat Say %id%02>
		Msg%id%01 <You must be \PC ... My men tell me that you're a pretty good pilot. Personally, I have my doubts.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCHeroic Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCVillainous Accept>
		Msg%id%02 <Don't flatter yourself; my time's too valuable to fight nobodies like you. Let's see how well you do against my lancemates.>
		Msg%id%02_1 <>
		CMsg%id%02_1 <ifNPCHeroic Accept>
		Msg%id%02_2 <How amusing, the mouse thinks it can challenge the cat. I'm not in the mood to kill you right now... that's what my lancemates are for.>
		CMsg%id%02_2 <ifNPCVillainous Accept>
		Prompt%id%01 <Prepare to defend yourself.>
		Prompt%id%01_1 <I'll show you how good I am.>
		Prompt%id%01_2 <I can take you.>
	end

Content
	name <Sorting Confrontation>
	requires <*:CS_MIX_Confrontation (1:A.---|1:A.nme)>
	desc <Who's better, you or the NPC? Let's decide!>
	changes <E:A>
	results <E:A.sr_ E:A.jr_>

	% E1 is the Enemy NPC
	% E2 is the outdoors scene where this encounter is

	% P%id%01 = ForceChat Counter
	update <if= P%id%01 0 P= %id%01 1 ForceChat %1%>

	.%id%_%plotid%_GoCombatWin  <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoWin   History %id%02  ifNPCOK %1% SetXXRAttitude %1% XXR_A_IsJunior  Monologue %1% %id%01>
	.%id%_%plotid%_GoCombatLoss <CancelSubPlot %plotid%  Trigger0 .%id%_%plotid%_GoLoss  History %id%04  ifNPCOK %1% SetXXRAttitude %1% XXR_A_IsSenior  Monologue %1% %id%03>

	Msg%id%01 <I guess that answers the question of which one of us is stronger... Woah.>
	Msg%id%01_1 <Wow, you're really good... It's too bad that we couldn't be on the same team.>
	CMsg%id%01_1 <ifNPCHeroic Accept>
	Msg%id%01_2 <No way! You must have cheated, you jerk!>
	CMsg%id%01_2 <ifNPCVillainous Accept>
	Msg%id%02 <You defeated %name1%.>
	Msg%id%03 <Just as I thought, you're nothing but a rookie...>
	Msg%id%03_1 <Your skills are lacking. Do us both a favor and stay out of my way from now on.>
	CMsg%id%03_1 <ifNPCHeroic Accept>
	Msg%id%03_2 <This is what happens to idiots who challenge me.>
	CMsg%id%03_2 <ifNPCVillainous Accept>
	Msg%id%04 <You were defeated by %name1%.>

	sub
		Persona 1
		special <UNLISTED>
		greeting <if= PlotStatus %plotid% %id% else %pop% EndChat Say %id%01 AddChat %id%01 AddChat %id%02>
		*result%id%01 <*THEME_EXPO&Enemy na>
		result%id%02 <AddEasygoing d10 Goto result%id%01>
		Msg%id%01 <Ah, \PC ... so we finally meet in combat. I wonder which one of us is the better pilot?>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCHeroic Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCVillainous Accept>
		Prompt%id%01 <I'll show you who the best pilot is!>
		Prompt%id%01_1 <There's only one way to find out.>
		Prompt%id%01_2 <You'll see who it is in a minute!>
		Prompt%id%02 <I have no idea.>
		Prompt%id%02_1 <Good question. I dunno.>
		Prompt%id%02_2 <Meh. Is it really that important?>
	end


