%%
%% Mecha Arena Quest Components
%%

%%
%% *:MECHA_ARENA_BASE
%%	Contains the arena manager.
%%
%%	Set QuestStatus when manager admits PC to arena; end the quest after the PC has
%%	completed the championship.
%%

Content
	name <Gaos Spinner Arena>
	requires <*:MECHA_ARENA_BASE GAOSP>

	% E1 is Hilda
	% E2 is the arena
	% E3 is the entrance to the arena
	Element1 <Prefab>
	Scene1 <arenasite>
	Team1 <Citizens>
	TeamData1 <Pass Ally>

	Scene2 <New *Arena_Valhalla>

	Quest1 <*:MECHA_ARENA_CHALLENGE #33 1 2>
	Quest2 <*:MECHA_ARENA_CHALLENGE #45 1 2>
	Quest3 <*:MECHA_ARENA_CHALLENGE #57 1 2>
	Quest4 <*:MECHA_ARENA_CHALLENGE #69 1 2>
	Quest5 <*:MECHA_ARENA_CHALLENGE #81 1 2>

	sub
		Persona 1
		greeting <if# QuestStatus %qid% 0 else GoPreQuest if= ArenaState %2% NAV_AS_Win else GoCheckLoss Goto GoArenaWin>
		GoCheckLoss <if= ArenaState %2% NAV_AS_Loss else GoCheckReady Goto GoArenaLoss>
		GoCheckReady <if= ArenaState %2% NAV_AS_Vacant else GoArenaFull ifG ComTime ArenaRecharge %2% else GoArenaBusy Goto GoOfferFight>

		GoArenaWin <if= ArenaWins %2% 10 else GoMinorWin Goto GoBigWin>
		*GoMinorWin <*BasicArenaWin %2% GoResetArena>
		*GoArenaLoss <*BasicArenaLoss %2% GoResetArena>
		GoResetArena <ResetArena %2%>

		*GoArenaFull <*ArenaIsFull %2%>
		*GoArenaBusy <*ArenaIsBusy %2%>

		GoChooseBattle <if= ArenaWins %2% 9 else GoCheckQ4 Goto .%id5%_GoInit>
		GoCheckQ4 <if= ArenaWins %2% 7 else GoCheckQ3 Goto .%id4%_GoInit>
		GoCheckQ3 <if= ArenaWins %2% 5 else GoCheckQ2 Goto .%id3%_GoInit>
		GoCheckQ2 <if= ArenaWins %2% 3 else GoCheckQ1 Goto .%id2%_GoInit>
		GoCheckQ1 <if= ArenaWins %2% 1 else GoNormalBattle Goto .%id1%_GoInit>
		*GoNormalBattle <*StartArenaBattle %2% GoStartFight>
		GoStartFight <SavePos PrepArena %2% 100 Jump %2%>
		*GoRefuseBattle <*RefuseArenaFight %2%>

		GoStartQuest <SetQuestStatus %qid% %id% SetArenaThreat %2% 25>

		GoOfferFight <NewChat Say 1 AddChat 1 AddChat 2>
		% Remember, there's a lot of fiddly bits for the big win.
		GoBigWin <NewChat Say 7 History 8 XPV 100 SetQuestStatus %qid% -1 RandomMecha .mektype 75 Goto GoResetArena>
		.mektype <PDASS REGEX KETTE BIOCO FEDDE>
		*GoPreQuest <*NiceToMeetYou GoArenaIntro>
		GoArenaIntro <NewChat Say 2 AddChat 3 AddChat 4>

		result1 <Goto GoChooseBattle>
		result2 <Goto GoRefuseBattle>
		result3 <NewChat Say 3 AddChat 5 AddChat 6 Goto GoStartQuest>
		result4 <NewChat Say 4>
		result5 <NewChat Say 5 AddChat 1 AddChat 2>
		result6 <NewChat Say 6 AddChat 1 AddChat 2 AddCheerful -d10>

		Msg1 <Welcome back to the Steel Arena. Are you ready to fight?>
		Msg2 <Welcome to the Steel Arena. Are you here to fight, or just to watch?>
		Msg3 <Our arena is on the far side of the rock. It's probably the best arena in all the colonies! We buried a ton of simgravs down there, so it feels just like you're fighting on Earth!>
		Msg4 <Alright, then. You should be able to see the fight on one of the monitors, somewhere...>
		Msg5 <It really is! We've got a battle coming up soon. Do you want to take part?>
		Msg6 <Er... no, no I haven't, but I watch all the mecha tournament shows... Earth pilots rock. So, do you want to fight now?>
		Msg7 <Since that was your tenth win, you've officially won our big prize! Here's a brand new dueling mecha, straight from Earth!>
		Msg8 <You were crowned champion of the Steel Arena.>

		Prompt1 <I'm ready to go.>
		CPrompt1 <ifChatNPCInPlay ifG PCMeks 0 Accept>
		Prompt2 <Wait a minute, okay?>
		Prompt3 <I'm here to fight!>
		Prompt4 <I think I'll just watch, for now.>
		Prompt5 <Sounds like fun!>
		Prompt6 <You've never been to Earth, have you?>

		MetaScene 1
		sub
			room
			name <Manager's Office>
			special <SHAREDPALETTE>
			desig <HOME>
			minimap <#...#........1......#---#>

			room
			name <Glory Road>
			special <SHAREDPALETTE>
			minimap <######&2&##...##...##...#>
			sub
				Elevator
				name <To Arena>
				desig <ENTRANCE %s2%>
				MiniMapComponent 2
			end
		end
	end
	inv
		NPC Celebrity
		name <Hilda>
		job <Arena Manager>
		chardesc Female Easygoing Sociable Renowned Renowned
		Age 6
		SetFaction 5
		SDL_PORTRAIT <por_f_sexy(AC-).png>
		SDL_COLORS <1 75 67 255 212 195 245 200 100>
	end


Content
	name <Cayley Rock Arena>
	requires <*:MECHA_ARENA_BASE CAYLE>

	% E1 is Peters
	% E2 is the arena
	% E3 is the entrance to the arena
	Element1 <Prefab>
	Scene1 <arenasite>
	Team1 <Citizens>
	TeamData1 <Pass Ally>

	Scene2 <New *Arena_SteelArena>

	Element3 <Prefab>
	Scene3 <Environs>

	Quest1 <*:MECHA_ARENA_CHALLENGE #35 1 2>
	Quest2 <*:MECHA_ARENA_CHALLENGE #60 1 2>

	sub
		Persona 1
		rumor0 <the steelworkers have a secret mecha tournament going on. Actually it's not much of a secret.>
		greeting <if# QuestStatus %qid% 0 else GoPreQuest if= ArenaState %2% NAV_AS_Win else GoCheckLoss Goto GoArenaWin>
		GoCheckLoss <if= ArenaState %2% NAV_AS_Loss else GoCheckReady Goto GoArenaLoss>
		GoCheckReady <if= ArenaState %2% NAV_AS_Vacant else GoArenaFull ifG ComTime ArenaRecharge %2% else GoArenaBusy Goto GoOfferFight>

		GoArenaWin <if= ArenaWins %2% 10 else GoMinorWin Goto GoBigWin>
		*GoMinorWin <*BasicArenaWin %2% GoResetArena>
		*GoArenaLoss <*BasicArenaLoss %2% GoResetArena>
		GoResetArena <ResetArena %2%>

		*GoArenaFull <*ArenaIsFull %2%>
		*GoArenaBusy <*ArenaIsBusy %2%>

		GoChooseBattle <if= ArenaWins %2% 9 else GoCheckQ1 Goto .%id2%_GoInit>
		GoCheckQ1 <if= ArenaWins %2% 5 else GoNormalBattle Goto .%id1%_GoInit>
		*GoNormalBattle <*StartArenaBattle %2% GoStartFight>
		GoStartFight <SavePos PrepArena %2% 100 Jump %2%>
		*GoRefuseBattle <*RefuseArenaFight %2%>

		GoStartQuest <SetQuestStatus %qid% %id% SetArenaThreat %2% 5>

		GoOfferFight <NewChat Say 1 AddChat 1 AddChat 2>
		% Remember, there's a lot of fiddly bits for the big win.
		GoBigWin <NewChat Say 7 History 8 XPV 100 SetQuestStatus %qid% -1 RandomMecha .mektype 75 Goto GoResetArena>
		.mektype <PDASS REGEX KETTE BIOCO FEDDE>
		*GoPreQuest <*NiceToMeetYou GoArenaIntro>
		GoArenaIntro <NewChat Say 2 AddChat 3 AddChat 4>

		result1 <Goto GoChooseBattle>
		result2 <Goto GoRefuseBattle>
		result3 <NewChat Say 3 AddChat 5 AddChat 6 Goto GoStartQuest>
		result4 <NewChat Say 4>
		result5 <NewChat Say 5 AddChat 1 AddChat 2>
		result6 <NewChat Say 6 AddChat 1 AddChat 2 AddCheerful -d10>

		Msg1 <Welcome back to the Steel Arena. Are you ready to fight?>
		Msg2 <Welcome to the Steel Arena. Are you here to fight, or just to watch?>
		Msg3 <Our arena is on the far side of the rock. It's probably the best arena in all the colonies! We buried a ton of simgravs down there, so it feels just like you're fighting on Earth!>
		Msg4 <Alright, then. You should be able to see the fight on one of the monitors, somewhere...>
		Msg5 <It really is! We've got a battle coming up soon. Do you want to take part?>
		Msg6 <Er... no, no I haven't, but I watch all the mecha tournament shows... Earth pilots rock. So, do you want to fight now?>
		Msg7 <Since that was your tenth win, you've officially won our big prize! Here's a brand new dueling mecha, straight from Earth!>
		Msg8 <You were crowned champion of the Steel Arena.>

		Prompt1 <I'm ready to go.>
		CPrompt1 <ifChatNPCInPlay ifG PCMeks 0 Accept>
		Prompt2 <Wait a minute, okay?>
		Prompt3 <I'm here to fight!>
		Prompt4 <I think I'll just watch, for now.>
		Prompt5 <Sounds like fun!>
		Prompt6 <You've never been to Earth, have you?>

		MetaScene 1
		sub
			room
			name <The Steel Arena>
			special <SHAREDPALETTE>
			desig <HOME>
			minimap <#...#........1......#---#>
		end
	end
	inv
		NPC Citizen
		name <Peters>
		job <Arena Manager>
		chardesc Male Passionate Sociable Cheerful Pragmatic
		Age 2
		SetFaction 5

		STC QUEST-MAPMARKER-AUTO-STATIONARY
		name <Steel Arena>
		desig <ENTRANCE %s2%>
	end



Content
	name <Mullins Arena>
	requires <*:MECHA_ARENA_BASE MAQSP>

	% E1 is Mullins
	% E2 is the arena
	% E3 is the entrance to the arena
	Element1 <Prefab>
	Scene1 <Building Public Sleazy>
	Team1 <Citizens>
	TeamData1 <Pass Ally>

	Scene2 <New *Arena_PrivateersArena>

	Element3 <Prefab>
	Scene3 <Environs>

	Quest1 <*:MECHA_ARENA_CHALLENGE #30 1 2>
	Quest2 <*:MECHA_ARENA_CHALLENGE #42 1 2>
	Quest3 <*:MECHA_ARENA_CHALLENGE #54 1 2>
	Quest4 <*:MECHA_ARENA_CHALLENGE #66 1 2>

	sub
		Persona 1
		rumor0 <Mullins used to be one of the greatest privateers, but had to retire when she was crippled in battle.>
		greeting <if# QuestStatus %qid% 0 else GoPreQuest if= ArenaState %2% NAV_AS_Win else GoCheckLoss Goto GoArenaWin>
		GoCheckLoss <if= ArenaState %2% NAV_AS_Loss else GoCheckReady Goto GoArenaLoss>
		GoCheckReady <if= ArenaState %2% NAV_AS_Vacant else GoArenaFull ifG ComTime ArenaRecharge %2% else GoArenaBusy Goto GoOfferFight>

		GoArenaWin <if= ArenaWins %2% 10 else GoMinorWin Goto GoBigWin>
		*GoMinorWin <*BasicArenaWin %2% GoResetArena>
		*GoArenaLoss <*BasicArenaLoss %2% GoResetArena>
		GoResetArena <ResetArena %2%>

		*GoArenaFull <*ArenaIsFull %2%>
		GoArenaBusy <if= QuestStatus %qid% -1 else GoReallyBusy Goto GoSkillTraining>
		*GoReallyBusy <*ArenaIsBusy %2%>

		GoChooseBattle <if= ArenaWins %2% 9 else GoCheckQ3 Goto .%id4%_GoInit>
		GoCheckQ3 <if= ArenaWins %2% 7 else GoCheckQ2 Goto .%id3%_GoInit>>
		GoCheckQ2 <if= ArenaWins %2% 5 else GoCheckQ1 Goto .%id2%_GoInit>>
		GoCheckQ1 <if= ArenaWins %2% 3 else GoNormalBattle Goto .%id1%_GoInit>
		*GoNormalBattle <*StartArenaBattle %2% GoStartFight>
		GoStartFight <SavePos PrepArena %2% 100 Jump %2%>
		*GoRefuseBattle <*RefuseArenaFight %2%>

		GoStartQuest <SetQuestStatus %qid% %id% SetArenaThreat %2% 10>

		GoOfferFight <NewChat Say 1 AddChat 1 AddChat 2 AddChat 3>
		GoBigWin <NewChat Say 4 History 5 XPV 500 SetQuestStatus %qid% -1 AddChat 4  CashPrize Reward Threat ArenaThreat %2% 100 100 Goto GoResetArena>
		GoSkillTraining <NewChat Say 6 AddChat 5>
		*GoPreQuest <*NiceToMeetYou GoArenaIntro>
		GoArenaIntro <NewChat Say 7 AddChat 6 AddChat 7 AddCHat 8>

		result1 <Goto GoChooseBattle>
		result2 <Goto GoRefuseBattle>
		result3 <EndChat Say 2 School .skills Say 3>
		.skills <1 2 3 4 5 6 7 8 9 10 12 17 18 42>
		result4 <Goto result3>
		result5 <Goto result3>
		result6 <NewChat Say 8 AddChat 1 AddChat 2 Goto GoStartQuest>
		result7 <NewChat Say 9 AddCheerful -1 Goto GoStartQuest>
		result8 <NewChat Say 10 AddChat 9 AddChat 10 AddLawful 1 AddEasygoing d4 AddRenown -1 Goto GoStartQuest>
		result9 <Goto result6>
		result10 <Goto GoRefuseBattle>

		Msg1 <Good to see you again. Are you ready to take part in today's fight?>
		Msg2 <There's more than one path to success in the arena. Choose a strategy and train accordingly.>
		Msg3 <The real test will come on the battlefield.>
		Msg4 <You did it! Congratulations, you are now the champion of the Privateer Arena! In recognition of this feat, I'll give you something more valuable than a prize: the chance to learn from my years of combat experience.>
		Msg5 <You were crowned champion at the Privateer Arena.>
		Msg6 <There's no battle going on right now, but I can teach you about combat if you'd like.>
		Msg7 <Hey, would you like to test your mettle in real combat? Some of the pirates around here run dueling matches just outside the spinner, in the shadow of the solar arrays. If you'd like to take part there's a cash prize for whoever wins.>
		Msg8 <There's a match ready to go right now. Would you like to take part, or will you be back later?>
		Msg9 <Come on back when you're feeling braver.>
		Msg10 <It's technically illegal, but the police have better things to worry about than a few pilots having a bit of fun. Sure people get hurt sometimes but everyone knew what they were getting into. What do you say?>

		Prompt1 <I'm ready to battle.>
		CPrompt1 <ifChatNPCInPlay ifG PCMeks 0 Accept>
		Prompt2 <Maybe some other time.>
		Prompt3 <I'd like to train my skills.>
		CPrompt3 <if= QuestStatus %qid% -1 Accept>
		Prompt4 <Let's start training right now.>
		Prompt5 <Let's do that.>
		Prompt6 <I'd like that very much.>
		Prompt7 <No thanks, I'd rather live.>
		Prompt8 <Isn't that illegal?>
		Prompt9 <Alright, I could give it a try.>
		Prompt10 <Sorry, that's not my thing.>

	end
	inv
		NPC Mercenary
		name <Mullins>
		% Mullins is Miaga's mother. She was a hero in the privateer fleet
		% until being horribly injured in the line of duty. The left half
		% of Mullins's body is mostly cybernetic.
		mecha <>
		statline 13 10 14 16 8 17 10 13
		CharDesc Female Heroic Criminal Sociable Melancholy Renowned
		% Age 45; since basic char age is 20, add +25.
		Age 25
		%% Mullins is a member of the Pro Duelist Association
		SetFaction 5
		EquipChar 25000
		SDL_PORTRAIT <por_f_mullins(O-Y).png>
		SDL_SPRITE <cha_f_bandit.png>
		SDL_COLORS <200 200 0 142 62 39 1 75 67>

		STC QUEST-MAPMARKER-AUTO-STATIONARY
		name <Privateer's Arena>
		desig <ENTRANCE %s2%>
	end

Content
	name <Debug Arena>
	requires <*:DEBUGARENA>
	%% This is a copy of the Cayley Arena used for debugging purposes. It should only load if
	%% an arena challenger is marked as *:DEBUG_MECHA_ARENA_CHALLENGE

	% E1 is Peters
	% E2 is the arena
	% E3 is the entrance to the arena
	Element1 <Prefab>
	Scene1 <cavclub>
	Team1 <Citizens>
	TeamData1 <Pass Ally>

	Scene2 <New *Arena_Default>

	Element3 <Prefab>
	Scene3 <Environs>

	Quest1 <*:DEBUG_MECHA_ARENA_CHALLENGE #5 1 2>

	sub
		Persona 1
		greeting <if# QuestStatus %qid% 0 else GoPreQuest if= ArenaState %2% NAV_AS_Win else GoCheckLoss Goto GoArenaWin>
		GoCheckLoss <if= ArenaState %2% NAV_AS_Loss else GoCheckReady Goto GoArenaLoss>
		GoCheckReady <if= ArenaState %2% NAV_AS_Vacant else GoArenaFull ifG ComTime ArenaRecharge %2% else GoArenaBusy Goto GoOfferFight>

		GoArenaWin <if= ArenaWins %2% 10 else GoMinorWin Goto GoBigWin>
		*GoMinorWin <*BasicArenaWin %2% GoResetArena>
		*GoArenaLoss <*BasicArenaLoss %2% GoResetArena>
		GoResetArena <ResetArena %2%>

		*GoArenaFull <*ArenaIsFull %2%>
		*GoArenaBusy <*ArenaIsBusy %2%>

		GoChooseBattle <if= ArenaWins %2% 0 else GoNormalBattle Goto .%id1%_GoInit>
		*GoNormalBattle <*StartArenaBattle %2% GoStartFight>
		GoStartFight <SavePos PrepArena %2% 100 Jump %2%>
		*GoRefuseBattle <*RefuseArenaFight %2%>

		GoStartQuest <SetQuestStatus %qid% %id% SetArenaThreat %2% 5>

		GoOfferFight <NewChat Say 1 AddChat 1 AddChat 2>
		% Remember, there's a lot of fiddly bits for the big win.
		GoBigWin <NewChat Say 7 History 8 XPV 100 SetQuestStatus %qid% -1 RandomMecha .mektype 75 Goto GoResetArena>
		.mektype <PDASS REGEX KETTE BIOCO FEDDE>
		*GoPreQuest <*NiceToMeetYou GoArenaIntro>
		GoArenaIntro <NewChat Say 2 AddChat 3 AddChat 4>

		result1 <Goto GoChooseBattle>
		result2 <Goto GoRefuseBattle>
		result3 <NewChat Say 3 AddChat 5 AddChat 6 Goto GoStartQuest>
		result4 <NewChat Say 4>
		result5 <NewChat Say 5 AddChat 1 AddChat 2>
		result6 <NewChat Say 6 AddChat 1 AddChat 2 AddCheerful -d10>

		Msg1 <Welcome back to the Steel Arena. Are you ready to fight?>
		Msg2 <Welcome to the Steel Arena. Are you here to fight, or just to watch?>
		Msg3 <Our arena is on the far side of the rock. It's probably the best arena in all the colonies! We buried a ton of simgravs down there, so it feels just like you're fighting on Earth!>
		Msg4 <Alright, then. You should be able to see the fight on one of the monitors, somewhere...>
		Msg5 <It really is! We've got a battle coming up soon. Do you want to take part?>
		Msg6 <Er... no, no I haven't, but I watch all the mecha tournament shows... Earth pilots rock. So, do you want to fight now?>
		Msg7 <Since that was your tenth win, you've officially won our big prize! Here's a brand new dueling mecha, straight from Earth!>
		Msg8 <You were crowned champion of the Steel Arena.>

		Prompt1 <I'm ready to go.>
		CPrompt1 <ifChatNPCInPlay ifG PCMeks 0 Accept>
		Prompt2 <Wait a minute, okay?>
		Prompt3 <I'm here to fight!>
		Prompt4 <I think I'll just watch, for now.>
		Prompt5 <Sounds like fun!>
		Prompt6 <You've never been to Earth, have you?>

		MetaScene 1
		sub
			room
			name <The Debug Arena>
			special <SHAREDPALETTE>
			desig <HOME>
			minimap <#...#........1......#---#>
		end
	end
	inv
		NPC Citizen
		job <Arena Manager>
		SDL_COLORS <49 91 161  255 212 195  244 216 28>
		SetFaction 5

		STC QUEST-MAPMARKER-AUTO-STATIONARY
		name <Steel Arena>
		desig <ENTRANCE %s2%>
	end

