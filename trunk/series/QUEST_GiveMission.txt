%%
%% *:GiveMission Content
%%
%% An NPC will give the PC a mission to complete. When the mission is
%% completed, the QuestStatus of this subquest will be set to -1. If
%% the mission is rendered uncompletable, the QuestStatus will be -2.
%%
%% Param1 is the NPC providing the mission
%%   note: Persona 1 must have a .%id%_GoInit script
%%	The parent quest must handle E1's reaction to
%%	successfully completing/losing this subquest,
%%	though this SQ should have a reminder message
%%	in Persona 1.
%%
%% Set REQUIRES to *:DebugMission to load into the debugging stub.

Content
	name <Go Beat Thieves>
	desc <Some mecha have been stolen, and are galavanting around. See what you can do.>
	requires <*:GiveMission (1:POLIC|1:CRAFT)>
	special <REUSABLE>

	% E1 is the NPC offering the mission
	% E2 is the encounter that is the mission
	Element2 <Prefab>
	Scene2 <Environs>

	sub
		Persona 1
		Greeting <if= QuestStatus %qid% %id% else %pop% NewChat Say %id%01>
		.%id%_GoInit <SetQuestStatus %qid% %id% NewChat Say %id%02 QMemo %qid% %id%03>
		Msg%id%01 <Those mecha thieves have not yet been brought to justice.>
		Msg%id%02 <Recently, a number of mecha have been stolen. The thieves are thought to be somewhere in the \SCENE %s2% area. If you could catch them, I'd have a reward for you.>
		Msg%id%03 <%name1% asked you to catch a gang of mecha thieves in \SCENE %s2% .>

		MetaScene 1
		end <if= QuestStatus %qid% %id% else %pop% ifNPCDead %1% else %pop% SetQuestStatus %qid% -2 Goto %pop%>
	end
	inv
		Encounter
		name <Stolen Mecha>
		Special <NoMSID>
		% V1 = Visibility Clock.
		%      If ComTime > V1 and QuestStatus %qid% = %id%, encounter is active
		update <if= QuestStatus %qid% %id% else GoHide ifG ComTime V1 else GoHide  SetStat STAT_MetaVisibility 0  Goto GoSetOrders>
		GoSetOrders <GrabSource GSetNAtt NAG_EpisodeData NAS_Orders 3>
		use <ifG StatVal STAT_MetaVisibility -1  Print -1  Goto GoStartCombat>
		ATTACK <ifG StatVal STAT_MetaVisibility -1    ifUStealth 15 else GoAutoAttack ifYesNo -3 -4 -5 else GoAvoidAttack Goto GoAutoAttack>
		GoAutoAttack <Alert -2 Goto GoStartCombat>
		GoAvoidAttack <Print -6 AddSociable -1>
		GoStartCombat <V= 1 ComTime V+ 1 86400  SavePos Dynamic 2 %threat% 100 .nu1 .nu2 ComposeD Msg1 .Msg1 DynaFaction 0>
		.nu1 <if= T1 0  Return   if= L2 0  L= 2 1  AddRenown -5  ItemVar= %2% 1 ComTime ItemVar+ %2% 1 d86400 ItemVar+ %2% 1 43200>
		.nu2 <if= T2 0           if= L2 0  L= 2 1  XPV 100  AddRenown 1   Alert 1  SetQuestStatus %qid% -1 DeleteItem %2%>
		.msg1 <You have defeated the mecha thieves.>
		EncounterMove 50
	end

Content
	name <Go Beat Invaders>
	desc <Some unauthorized mecha have shown up in the city. See what you can do.>
	requires <*:GiveMission (1:MILIT|1:POLIT|1:ADVEN)>
	special <REUSABLE>

	% E1 is the NPC offering the mission
	% E2 is the encounter that is the mission
	Element2 <Prefab>
	Scene2 <Urban>

	sub
		Persona 1
		Greeting <if= QuestStatus %qid% %id% else %pop% NewChat Say %id%01>
		.%id%_GoInit <SetQuestStatus %qid% %id% NewChat Say %id%02 QMemo %qid% %id%03>
		Msg%id%01 <The infiltrators in \SCENE %s2% have not yet been dealt with.>
		Msg%id%02 <A team of unknown mecha has been detected in \SCENE %s2% . We don't yet know their intentions, but they must be stopped before they have a chance to do any damage.>
		Msg%id%03 <%name1% asked you to locate and eliminate some mecha infiltrators in \SCENE %s2% .>

		MetaScene 1
		end <if= QuestStatus %qid% %id% else %pop% ifNPCDead %1% else %pop% SetQuestStatus %qid% -2 Goto %pop%>
	end
	inv
		Encounter
		name <Invaders>
		Special <NoMSID>
		% V1 = Visibility Clock.
		%      If ComTime > V1 and QuestStatus %qid% = %id%, encounter is active
		update <if= QuestStatus %qid% %id% else GoHide ifG ComTime V1 else GoHide  SetStat STAT_MetaVisibility 0  Goto GoSetOrders>
		GoSetOrders <GrabSource GSetNAtt NAG_EpisodeData NAS_Orders 3>
		use <ifG StatVal STAT_MetaVisibility -1  Print -1  Goto GoStartCombat>
		ATTACK <ifG StatVal STAT_MetaVisibility -1    ifUStealth 15 else GoAutoAttack ifYesNo -3 -4 -5 else GoAvoidAttack Goto GoAutoAttack>
		GoAutoAttack <Alert -2 Goto GoStartCombat>
		GoAvoidAttack <Print -6 AddSociable -1>
		GoStartCombat <V= 1 ComTime V+ 1 86400  SavePos Dynamic 2 %threat% 100 .nu1 .nu2 ComposeD Msg1 .Msg1 DynaFaction 0>
		.nu1 <if= T1 0  Return   if= L2 0  L= 2 1  AddRenown -5  ItemVar= %2% 1 ComTime ItemVar+ %2% 1 d86400 ItemVar+ %2% 1 43200>
		.nu2 <if= T2 0           if= L2 0  L= 2 1  XPV 100  AddRenown 1   Alert 1  Salvage  SetQuestStatus %qid% -1 DeleteItem %2%>
		.msg1 <You have defeated the invaders.>
		EncounterMove 50
	end

Content
	name <Go Beat Bandits>
	desc <Some bandits have been attacking truckers. See what you can do.>
	requires <*:GiveMission (1:CORPO|1:TRADE|1:LABOR)>
	special <REUSABLE>

	% E1 is the NPC offering the mission
	% E2 is the encounter that is the mission
	Element2 <Prefab>
	Scene2 <Environs>

	sub
		Persona 1
		Greeting <if= QuestStatus %qid% %id% else %pop% NewChat Say %id%01>
		.%id%_GoInit <SetQuestStatus %qid% %id% NewChat Say %id%02 QMemo %qid% %id%03>
		Msg%id%01 <The bandits who have been attacking our truckers are still on the loose.>
		Msg%id%02 <Several of our truckers have been attacked by bandits in \SCENE %s2% . If you could locate these bandits and eliminate them, I'd have a reward for you.>
		Msg%id%03 <%name1% asked you to locate some bandits in \SCENE %s2% that have been attacking truckers.>

		MetaScene 1
		end <if= QuestStatus %qid% %id% else %pop% ifNPCDead %1% else %pop% SetQuestStatus %qid% -2 Goto %pop%>
	end
	inv
		Encounter
		name <Bandits>
		Special <NoMSID>
		% V1 = Visibility Clock.
		%      If ComTime > V1 and QuestStatus %qid% = %id%, encounter is active
		update <if= QuestStatus %qid% %id% else GoHide ifG ComTime V1 else GoHide  SetStat STAT_MetaVisibility 0  Goto GoSetOrders>
		GoSetOrders <GrabSource GSetNAtt NAG_EpisodeData NAS_Orders 3>
		use <ifG StatVal STAT_MetaVisibility -1  Print -1  Goto GoStartCombat>
		ATTACK <ifG StatVal STAT_MetaVisibility -1    ifUStealth 15 else GoAutoAttack ifYesNo -3 -4 -5 else GoAvoidAttack Goto GoAutoAttack>
		GoAutoAttack <Alert -2 Goto GoStartCombat>
		GoAvoidAttack <Print -6 AddSociable -1>
		GoStartCombat <V= 1 ComTime V+ 1 86400  SavePos Dynamic 2 %threat% 100 .nu1 .nu2 ComposeD Msg1 .Msg1 DynaFaction 0>
		.nu1 <if= T1 0  Return   if= L2 0  L= 2 1  AddRenown -5  ItemVar= %2% 1 ComTime ItemVar+ %2% 1 d86400 ItemVar+ %2% 1 43200>
		.nu2 <if= T2 0           if= L2 0  L= 2 1  XPV 100  AddRenown 1   Alert 1  Salvage  SetQuestStatus %qid% -1 DeleteItem %2%>
		.msg1 <You have defeated the bandits.>
		EncounterMove 50
	end


%%
%% *:DebugGiveMission Content
%%
%% Loads a mission into the Cavalier's Club for easy debugging.
%%

Content
	name <DEBUG>
	requires <*:DebugGiveMission>
	desc <The NPC will give the PC a mission, to be handled by a "GiveMission" subquest.>

	% E1 is the person who will be giving the mission.
	Element1 <NewNPC 0 0>
	Scene1 <CavClub>
	Team1 <Citizens>
	TeamData1 <Ally Pass>

	% SubQuest1 is the mission.
	Quest1 <*:DebugMission 1>

	sub
		Persona 1
		rumor0 <%name1% needs a cavalier for a mission of some kind.>
		greeting <if= QuestStatus %qid% %id% else GoCheckFirst if= QUestStatus %qid1% -1 else GoCheckLoss NewChat Say 1 SetQuestStatus %qid% -1>
		GoCheckLoss <if= QuestStatus %qid1% -2 else GoCheckFirst SetQuestStatus %qid% -2 Goto GoEndInLoss>
		*GoEndInLoss <*MissionWasFailure na na na>
		GoCheckFirst <if= QuestStatus %qid% 0 else GoChat Goto GoOfferQuest>
		*GoOfferQuest <*DoYouWantAJob GoStartQuest>
		GoStartQuest <SetQuestStatus %qid% %id% Goto .%id1%_GoInit>
		GoChat <NewChat SayAnything>
		Msg1 <I hear that you succeeded. The debugging of the mission is now over.>
	end




