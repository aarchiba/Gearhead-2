%%
%% *CS_Win_Then_Guard
%%
%% The PC has won a mission, but learned that the enemy are planning to strike
%% at a certain scene.
%%
%% Param1: The Mission-giver
%% Param2: The scene the enemy are planning to hit

Content
	name <You better get going>
	desc <The PC will be given some money and sent on his way.>
	requires <*CS_Win_Then_Guard>

	% E1 is the NPC.
	% E2 is the target scene.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo %id%01 WinComp %2% .%id%_loss>
	.%id%_loss <+Tgj +Ffi>
	Msg%id%01 <Your enemies are planning to attack %name2%.>

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportSuccess>
		.%id%_GoReportSuccess <NewChat Say %id%01 SMemo %id%02 CashPrize Reward StoryDL 500 WinComp %2% .%id%_win>
		.%id%_win <+Tgj +Ffi>
		Msg%id%01 <Good job. Now, you should head over to %name2% right away, before the attack starts.>
		Msg%id%02 <Your enemies are planning to attack %name2%.>
	end

%%
%% *CS_Lose_Then_Guard
%%
%% The PC has lost a mission, but learned that the enemy are planning to strike
%% at a certain scene.
%%
%% Param1: The Mission-giver
%% Param2: The scene the enemy are planning to hit

Content
	name <Just go>
	desc <The PC will be sent on his way.>
	requires <*CS_Lose_Then_Guard>

	% E1 is the NPC.
	% E2 is the target scene.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo %id%01 LoseComp %2% .%id%_loss>
	.%id%_loss <+Tgj +Ffi>
	Msg%id%01 <Your enemies are planning to attack %name2%.>

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportFailure>
		.%id%_GoReportFailure <NewChat Say %id%01 SMemo %id%02 LoseComp %2% .%id%_loss>
		.%id%_loss <+Tgj +Ffi>
		Msg%id%01 <You failed to stop those mecha, but it might not be too late to save %name2%.>
		Msg%id%02 <Your enemies are planning to attack %name2%.>
	end


%%
%% *CS_Win_MechaRetribution
%%
%% The PC has won a mecha retribution encounter. This subplot is free to modify
%% the story as it sees fit.
%%
%% Param1: The Mission-giver

Content
	name <There Are Others>
	desc <The NPC will refer the PC to someone else who's had problems.>
	requires <*CS_Win_MechaRetribution>

	% E1 is the NPC.
	% E2 is the other NPC who's had troubles
	% E3 is the scene for the next meeting
	Element2 <Character !Near -7 !Okay -3 !Xclude -2 !Okay 1>
	Element3 <Scene Building Public !Okay 2>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% NewChat Say %id%01 AddChat %id%01 AddChat %id%02 SMemo 0 Goto .%id%_GoEnd>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 SMemo 0 NTBWinComp 0 .%id%_win>
		.%id%_win <+T-- +F-->
		Result%id%01 <ifNPCOK %2% else .%id%_GoFail NewChat Say %id%02 StoryNote %id%03 &SetTargetNPC %2% &SetCompScene %3% AlterContext .%id%_GoHelp>
		.%id%_GoHelp <+Tgt +Fmi>
		.%id%_GoFail <NewChat Say %id%05>
		Result%id%02 <NewChat  AddSociable -d10  Say %id%04>
		Msg%id%01_10 <You've made \FACTION &EnemyFac pay for what they did here, but they haven't been stopped. I know there are others who have suffered at their hands.>
		CMsg%id%01_10 <ifFactionExists &EnemyFac Accept>
		Msg%id%01_20 <You've made those raiders pay, but I fear that this is only the beginning. Other people have also been attacked.>
		CMsg%id%01_20 <if= &EnemyFac 0 Accept>
		Msg%id%02 <In that case, go see %name2% at %name3% . I hear that \SPR %2% has also suffered from unprovoked mecha attacks.>
		Msg%id%03 <%name1% sent you to help %name2% at %name3% .>
		Msg%id%04 <Given time, it's likely to become everyone's problem.>
		Msg%id%05 <I'm sure that given time you'll get that chance.>
		Prompt%id%01 <I'd like to help them, too.>
		Prompt%id%02 <That's not my problem.>
	end

Content
	name <Justice Has Been Served>
	desc <The NPC will pay the PC for the job.>
	requires <*CS_Win_MechaRetribution -1:THIEF>

	% E1 is the NPC.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% NewChat Say %id%01 SMemo 0 Goto .%id%_GoEnd>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 SMemo 0 NTBWinComp 0 .%id%_win>
		.%id%_win <+T-- +F-->
		Msg%id%01 <They have been punished. Thanks for your help.>
	end



%%
%% *CS_Win_UnexpectedMeeting Content
%%	&Rescue		The PC rescued the NPC
%%
%% During the last mission, the PC met someone. The mission giver will now probably
%% tell the PC to go look for that person, or something.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%% Param2: The NPC who was met
%%

Content
	name <You Work Well Together>
	desc <The PC will be teamed up with the person he just met.>
	requires <*CS_Win_UnexpectedMeeting R:-- 1:ALLY -2:ENEMY (+C--|+Cro) (1:CORPO|1:TRADE|1:LABOR|1:POLIT) (2:CORPO|2:LABOR)>

	% E1 is the mission-giver.
	% E2 is the NPC previously met

	% V%id%01 = Initialization counter
	update <if= PlotStatus %id% else %pop% if= v%id%01 0 else %pop% MoveNPC %2% NPCScene %1% V= %id%01 1>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1%  SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% ifNPCOK %2% else .%id%_GoTrivial ifCHatNPCInPlay else .%id%_GoNotHere NewChat Say %id%01  AddChat %id%01  AddChat %id%02>
		*.%id%_GoTrivial <*MissionWasSuccess&Reward .%id%_GoEnd &AllyFac &EnemyFac>
		.%id%_GoEnd <CashPrize Reward StoryDL 300  SMemo 0  NTBWinComp 0 .%id%_end>
		.%id%_GoNotHere <NewChat Say %id%02>
		.%id%_end <+T-- +F-->
		Result%id%01 <NewChat Say %id%03 StoryNote %id%04 &SetPartnerNPC %2%  CashPrize Reward StoryDL 300  NTBWinComp 0 .%id%_GetPartner>
		.%id%_GetPartner <+T-- +F-- +Cme>
		Result%id%02 <NewChat Say %id%05 SMemo 0           AddSociable -d10   Goto .%id%_GoEnd>
		Msg%id%01 <Good work out there, \PC . I hear that you met %name2% during the mission. How did you enjoy working together?>
		Msg%id%02 <Come to \SCENE NPCScene %1% and we can talk there.>
		Msg%id%03 <In that case, I'd like to assign \SPR %1% as your partner. Here's your pay for a successful mission.>
		Msg%id%04 <%name1% assigned %name2% as your partner.>
		Msg%id%05 <That's too bad. Well, here's your pay for a successful mission.>
		Prompt%id%01 <I'd say we made a good team.>
		Prompt%id%02 <That's not something I'd want to do again.>

		Persona 2
		greeting <if= PlotStatus %id% else %pop% NewChat Say %id%01>
		Msg%id%01 <You should go speak with %name1% now.>
	end


Content
	name <He'll want to thank you>
	desc <The PC will be sent to find the NPC, because he'll want to thank him.>
	requires <*CS_Win_UnexpectedMeeting &Rescue>

	% E1 is the mission-giver.
	% E2 is the NPC previously met

	start <if= PlotStatus %id% else %pop% ifNPCDead %1%  SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% CashPrize Reward StoryDL 300 ifNPCOK %2% else .%id%_GoNPCGone Goto .%id%_GoSearchNPC>
		.%id%_GoSearchNPC <NewChat Say %id%01 SMemo %id%02 History %id%03 &SetTargetNPC %2% WinComp 0 .%id%_Win>
		*.%id%_GoNPCGone <*MissionWasSuccess&Reward .%id%_GoEnd &AllyFac &EnemyFac>
		.%id%_GoEnd <SMemo 0 WinComp 0 .%id%_end>
		.%id%_win <+Tlt +Frt>
		.%id%_end <+T-- +F-->
		Msg%id%01 <Good work on that mission. You should probably try to find that person you rescued; I'll bet \SPR %2% will want to reward you.>
		Msg%id%01_1 <I'm quite satisfied with the results of that last mission, but I'm quite sure there's someone else who will want to thank you as well. Have you spoken to %name2% since getting back? I think you should.>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <Good job. I have nothing else for you to do now, although I'm sure %name2% will want to speak with you.>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <That went fairly well, I think. If you're looking for something else to do now, you should try and find that person you rescued. Maybe you can get another reward from \OPR %2% .>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <Brilliant work, \PC . I'll bet %name2% will want to thank you for rescuing \OPR %2% .>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <I knew you'd come through on that mission. Here's a reward... You might want to see if you can find %name2%, since I'm certain \SPR %2% 'll want to reward you as well.>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <The mission was a success. In the name of completeness, though, you should try to find %name2% and make sure \SPR %2% got back alright.>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <You should try to find %name2%, whom you recently rescued.>
		Msg%id%03 <%name1% suggested that %name2% might want to thank you.>
	end

Content
	name <Find out what he knows>
	desc <The PC is asked to locate the previously met NPC, and find out what he knows.>
	requires <*CS_Win_UnexpectedMeeting>

	% E1 is the mission-giver.
	% E2 is the NPC previously met

	start <if= PlotStatus %id% else %pop% ifNPCDead %1%  SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% NewChat Say %id%01 AddChat %id%01 AddChat %id%02>
		.%id%_win <+Tlt +Fin>
		.%id%_meh <+T-- +F-->
		result%id%01 <ifNPCOK %2% else .%id%_GoTargetDead NewChat Say %id%02 &SetTargetNPC %2% WinComp 0 .%id%_win CashPrize Reward StoryDL 200 AddReact d10 SMemo %id%04>
		.%id%_GoTargetDead <NewChat Say %id%03 SMemo 0 WinComp 0 .%id%_meh CashPrize Threat StoryDL 100 300>
		result%id%02 <NewChat Say %id%05 SMemo 0 WinComp 0 .%id%_meh CashPrize Threat StoryDL 100 150 AddSociable -d10>
		Msg%id%01 <Welcome back, \PC . How did the mission go?>
		Msg%id%01_1 <What's the progress on the mission I assigned to you? Do you have anything to report?>
		Msg%id%01_2 <Did you complete the mission I assigned to you? I've been waiting for your report.>
		Msg%id%02 <%name2% might know something about our enemy. You should try to find \OPR %2% and see what you can learn.>
		Msg%id%02_1 <Interesting. %name2% might have some useful information. You should try to find \OPR %2% and see what you can learn.>
		Msg%id%03 <I'm sure that's not important. Here's your reward for completing the mission.>
		Msg%id%04 <You should seek %name2% to find out what \SPR %2% knows.>
		Msg%id%05 <I see. Here's your reward, then.>
		Msg%id%05_1 <I knew you wouldn't have any problem. Here's a reward for your efforts.>
		CMsg%id%05_1 <ifG React 40 Accept>
		Msg%id%05_2 <I find that hard to believe... but as long as the job has been done, here's your reward.>
		CMsg%id%05_2 <ifG 10 React Accept>
		Prompt%id%01 <I met someone named %name2%.>
		Prompt%id%01_1 <During the mission I met %name2%.>
		Prompt%id%02 <It was completed without incident.>
		Prompt%id%02_1 <There's nothing special to report.>
	end

%%
%% *CS_Loss_UnexpectedMeeting Content
%%
%% During the last mission, the PC met someone. Unfortunately that person apparently
%% died or something.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%% Param2: The NPC who was met
%%

Content
	name <Too bad we couldn't find that pilot...>
	desc <The mission-giver laments the loss of E2.>
	requires <*CS_Loss_UnexpectedMeeting>

	% E1 is the mission-giver.
	% E2 is the NPC who was lost

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop%  NewChat Say %id%01 AddChat %id%01  AddChat %id%02>

		.%id%_GoEnd <SMemo 0  NTBLoseComp 0 .%id%_loss>
		.%id%_loss <+T-- +F-->
		.%id%_GoContinue <SMemo %id%05  &SetTargetNPC %2% LoseComp 0 .%id%_find>
		.%id%_find <+Tlt +Fin>

		result%id%01 <ifNPCDead %2% else .%id%_GoE2Find NewChat Say %id%02 Goto .%id%_GoEnd>
		.%id%_GoE2Find <NewChat Say %id%03  Goto .%id%_GoContinue>
		*result%id%02 <*MissionWasFailure .%id%_GoR2Finish &AllyFac &EnemyFac>
		.%id%_GoR2Finish <AddSociable -d8  Goto .%id%_GoEnd>

		Msg%id%01 <I understand that things didn't go well on the mission.>
		Msg%id%02 <Whatever information %name2% might have had is now gone as well...>
		Msg%id%03 <Reports indicate that %name2% is still out there; if you could find \OPR %2% , maybe \SPR %2% could give us some useful information.>

		Msg%id%05 <You should seek %name2% to find out what \SPR %2% knows.>
		Prompt%id%01 <I couldn't save %name2%.>
		Prompt%id%01_1 <I failed; %name2% was lost.>
		Prompt%id%02 <I don't want to talk about it.>
		Prompt%id%02_1 <You don't want to know.>
	end

%%
%% *CS_Win_ToUnknownEnemy Content
%%
%% The PC has won a mission and the plot state has changed to +Pun.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%%

Plot
	name <City in Trouble>
	desc <PC asked to help defend against the unknown enemy.>
	requires <*CS_Win_ToUnknownEnemy (P:--|P:CORPO|P:PDASS) (F:MILIT|F:CRIME|F:--) (1:POLIT|1:POLIC|1:MILIT) -L:ENEMY>

	% E1 is the target NPC.
	% E3 is the next NPC to meet about a mission
	% E3 is the scene for the next mission
	% E4 is the local government faction
	element2 <Character !Near -7 !Ally -7>
	element3 <MetaScene !Near -7 *Building NeverFail>
	element4 <Faction Government !Comrade -7>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-->

	sub
		Persona 1
		% V%id%01 = Have given reward
		greeting <if= PlotSTatus %id% else %pop% if= V%id%01 0 else .%id%_GoNewMission CashPrize Reward StoryDL 500 V= %id%01 1 Goto .%id%_GoGetReward>
		*.%id%_GoGetReward <*MissionWasSuccess&Reward .%id%_GoRewardOp N3 N2>
		.%id%_GoRewardOp <AddChat %id%03>
		.%id%_GoNewMission <NewChat Say %id%01 AddChat %id%01 AddChat %id%02>
		result%id%01 <ifNPCOK %2% else .%id%_GoNoMission NewChat Say %id%03 &SetTargetNPC %2% &SetAllyFac %4% History %id%05 StoryNote %id%02 WinComp %3% .%id%_changes>
		.%id%_changes <+Tgt +Fmi>
		.%id%_GoNoMission <NewChat Say %id%04 &SetAllyFac %4% StoryNote %id%05 WinComp 0 .%id%_changes2>
		*result%id%02 <*RejectMission .%id%_GoR2Exit>
		.%id%_GoR2Exit <StoryNote %id%06 WinComp 0 .%id%_changes2>
		.%id%_changes2 <+T-->
		result%id%03 <Goto .%id%_GoNewMission>
		Msg%id%01 <We still don't know where these invaders are coming from, nor what they want. You know, %name4% could use a good pilot like you to help face this threat.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <%name1% sent you to speak with %name2% in %name3%.>
		Msg%id%03 <In that case you should go to %name3% and speak with %name2%. I believe \SPR E2 has something you could help with.>
		Msg%id%04 <That's good to hear. Go rest up, and get your stuff repaired. There's no telling when we could be attacked again.>
		Msg%id%05 <You accepted %name1%'s request to help defend %name4%.>
		Msg%id%06 <You declined %name1%'s request to help defend %name4%.>
		Prompt%id%01 <It would be an honor to help.>
		Prompt%id%02 <Sorry, I'm not signing up for anyone's war.>
		Prompt%id%03 <Thank you.>
	end


%%
%% *CS_Loss_ToUnknownEnemy Content
%%
%% Catch-all lose mission component.
%% The PC has lost a mission provided by the NPC.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%%

Content
	name <Default Loss>
	desc <The NPC will debrief the PC on the loss.>
	requires <*CS_Loss_ToUnknownEnemy>

	% E1 is the NPC.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% NewChat Say %id%01 SMemo 0 NTBLoseComp 0 .%id%_loss>
		.%id%_loss <+T-- +F-->
		Msg%id%01 <You have failed in the mission. Unless we can learn what our enemy is after, we have no chance of success.>
		Msg%id%01_1 <We have lost, and even worse we don't know the purpose behind these attacks.>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <You lost the mission. Our enemy moves in secret, but soon all will be revealed.>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <That last mission didn't go so well. It'd be a lot easier to deal with these attacks if we knew what they were after.>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <You failed. There must be some purpose behind the attacks, but until we figure it out we are forced to play sitting ducks.>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <Too bad about that last mission, but don't let it get you down. We have to keep our guard up. There's no telling when another attack could come.>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <Your mission was a complete failure. This is madness... how are we supposed to defend ourselves, when we don't even know what the enemy is after?>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%01_10 <We have to learn what \FACTION &EnemyFac is up to. It seems like that's the only chance we have to stop them.>
		CMsg%id%01_10 <ifFactionExists &EnemyFac Accept>
		Msg%id%01_20 <It's clear now that \PERSONA &EnemyNPC has some reason for these attacks, but what could it be?>
		CMsg%id%01_20 <ifNPCOK &EnemyNPC Accept>
	end

%%
%% *CS_Win_RevealEnemyNPC
%%
%% The PC has defeated a new enemy NPC; this NPC should _not_ have been set as
%% the story enemy by the calling component! That will probably but not nessecarily
%% be done here. This component may alter the story state.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%% Param2: The enemy met; check to make sure he's not dead
%%

Content
	name <Begin the Manhunt>
	desc <The PC will begin a manhunt for the enemy NPC.>
	requires <*CS_Win_RevealEnemyNPC (C:POLIC|P:POLIC|2:THIEF|E:++)>

	% E1 is the mission-giver.
	% E2 is the target.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportSuccess>
		.%id%_GoReportSuccess <NewChat Say %id%01 AddChat %id%01 Goto .%id%_GoEnd>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 ifNPCOK %2% else .%id%_GoTrivialEnd SMemo %id%02  &SetTargetNPC %2%  WinComp 0 .%id%_win>
		.%id%_GoTrivialEnd <SMemo 0  NTBWinComp 0 .%id%_meh>
		.%id%_win <+Tht +Far>
		.%id%_meh <+T-- +F-->
		Result%id%01 <NewChat Say %id%03>
		Msg%id%01 <Good work on the mission. Here's a reward.>
		Msg%id%02 <%name2% could still be in \SCENE &EpisodeScene ; you should probably try to find \OPR %2% .>
		Msg%id%03 <If %name2% is still nearby, it could be dangerous. It's important that \SPR %2% be found before \SPR %2% can attack again.>
		Prompt%id%01 <I fought someone named %name2%.>
		CPrompt%id%01 <ifNPCOK %2% Accept>
	end

Content
	name <E2 is a priority>
	desc <The new enemy will become the core story enemy.>
	requires <*CS_Win_RevealEnemyNPC E:-->

	% E1 is the mission-giver.
	% E2 is the target.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% ifNPCOK %2% else .%id%_GoReportSuccess &SetEnemyNPC %2% NewChat Say %id%01 Goto .%id%_GoEnd>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 SMemo 0 NTBWinComp 0 .%id%_win>
		.%id%_win <+T-- +F-->
		Msg%id%01 <Good work out there, \PC . I think we should try to find out more about this mysterious pilot, %name2%.>
	end

%%
%% *CS_Loss_RevealEnemyNPC
%%
%% The PC has lost to a new enemy NPC; this NPC should _not_ have been set as
%% the story enemy by the calling component! That will probably but not nessecarily
%% be done here. This component may alter the story state.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%% Param2: The enemy met; check to make sure he's not dead
%%

Content
	name <Never Again>
	desc <The PC will make up for this loss by finding E2.>
	requires <*CS_Loss_RevealEnemyNPC>

	% E1 is the mission-giver.
	% E2 is the target.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 LOseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportFailure>
		.%id%_GoReportFailure <NewChat Say %id%01 AddChat %id%01 SMemo 0  NTBLoseComp 0 .%id%_loss>
		.%id%_hunt <+Tht +Far>
		.%id%_loss <+T-- +F-->
		Result%id%01 <NewChat Say %id%03 SMemo %id%02  &SetTargetNPC %2%  AlterContext .%id%_hunt>
		Msg%id%01 <You were defeated by %name2%. This is very bad.>
		Msg%id%02 <%name2% could still be in \SCENE &EpisodeScene ; you should probably try to find \OPR %2% .>
		Msg%id%03 <I certainly hope that you can. If \SPR %2% is still in \SCENE &EpisodeScene we could be in for some more trouble.>
		Prompt%id%01 <I will find %name2%, and finish this.>
		CPrompt%id%01 <ifNPCOK %2% Accept>
	end

Content
	name <Default Loss to Enemy NPC>
	desc <The NPC will debrief the PC on the loss; E2 becomes the core enemy.>
	requires <*CS_Loss_RevealEnemyNPC E:-->

	% E1 is the NPC.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportLoss>
		*.%id%_GoReportLoss <*MissionWasFailure .%id%_GoEnd &AllyFac &EnemyFac>
		.%id%_GoEnd <SMemo 0 NTBLoseComp 0 .%id%_loss ifNPCOK %2% &SetEnemyNPC %2%>
		.%id%_loss <+T-- +F-->
	end


%%
%% *CS_CAWinMission Content
%%	&RevealEF	The enemy faction has been revealed
%%
%% Catch-all win mission component.
%% The PC has won a mission provided by the NPC. Note that the mission should not
%% have altered the state of the story; therefore, this reward is free to do so
%% itself.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%%

Content
	name <There's more of them out there>
	desc <The NPC will pay the PC for the job, and reveal the presence of more stuff.>
	requires <*CS_CAWinMission>

	% E1 is the NPC.
	% E2 is an environs scene
	% E3 an encounter for the next scene
	Element2 <Scene Environs !Near -7>
	Element3 <Prefab>
	Place3 <2>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportSuccess>
		.%id%_GoReportSuccess <NewChat Say %id%01 StoryNote %id%02 CashPrize Reward StoryDL 500 WinComp %3% .%id%_win>
		.%id%_win <+Ten +Ffi>
		Msg%id%01 <The mission was a success... but that might not be the end of it. There have been reports that more enemy mecha have been spotted in %name2%.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <You learned that more enemy mecha were seen in %name2%.>
	end
	inv
		STC ENCOUNTER
		name <Enemy Mecha?>
		EncounterMove 50
	end

Content
	name <You Have Another Mission>
	desc <The NPC will pay the PC, then direct him to another mission.>
	requires <*CS_CAWinMission 1:PCFAC>

	% E1 is the NPC.
	% E2 is another NPC the PC can speak with
	% E3 is a scene for the meeting
	Element2 <Character !Near -7 !Comrade 1>
	Element3 <Scene Building Public !Near -7 !Okay 2>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% ifNPCOK %2% else .%id%_GoReportSuccess  NewChat Say %id%01 SMemo %id%02 Goto .%id%_GoEnd>
		*.%id%_GoReportSuccess <*MissionWasSuccess&Reward .%id%_GoMeh &AllyFac &EnemyFac>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 &SetTargetNPC %2% WinComp %3% .%id%_win>
		.%id%_win <+Tgt +Fmi>
		.%id%_GoMeh <CashPrize Reward StoryDL 500 NTBWinComp 0 .%id%_meh>
		.%id%_meh <+T-- +F-->
		Msg%id%01 <Good job on that mission. I think %name2% has some more work for you; you should go meet \OPR %2% at %name3%.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <%name1% sent you to %name2% at %name3% for another mission.>
	end

Content
	name <Pass the Buck>
	desc <The NPC will send the PC to talk with someone else.>
	requires <*CS_CAWinMission>

	% E1 is the NPC.
	% E2 is another NPC the PC can speak with
	% E3 is a scene for the meeting
	Element2 <Character !Near -7 !Ally 1 !Okay -3>
	Element3 <Scene Building Public !Near -7 !Okay 2>

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% SMemo 0  ifNPCOK %2% else .%id%_GoReportSuccess  if# ChatNPCFac 0 else .%id%_GoReportSuccess NewChat Say %id%01 SMemo %id%02 Goto .%id%_GoEnd>
		*.%id%_GoReportSuccess <*MissionWasSuccess&Reward .%id%_GoMeh &AllyFac &EnemyFac>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 &SetTargetNPC %2% WinComp %3% .%id%_win>
		.%id%_win <+Tgt +Fmi>
		.%id%_GoMeh <CashPrize Reward StoryDL 500 NTBWinComp 0 .%id%_meh>
		.%id%_meh <+T-- +F-->
		Msg%id%01 <Good work, \PC . If you want to see this through, I believe %name2% at %name3% has another mission you could help with.>
		Msg%id%01_1 <Thanks \PC . We're going to need a lot of help to fight this problem... I believe %name2% at %name3% is looking for someone to run another mission, if you're interested.>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <Good job. %name2% at %name3% has another mission for you, if you're interested.>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <Back for your pay, I see. I believe %name2% at %name3% has another mission if you're planning to continue this.>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <One battle's over, but we're a long way from the end yet... %name2% could use some help over at %name3% , if you're up for another mission.>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <%name1% sent you to %name2% at %name3% for another mission.>
	end

Content
	name <Here, have some money>
	desc <The NPC will pay the PC for the job.>
	requires <*CS_CAWinMission>

	% E1 is the NPC.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportSuccess>
		*.%id%_GoReportSuccess <*MissionWasSuccess&Reward .%id%_GoEnd &AllyFac &EnemyFac>
		.%id%_GoEnd <CashPrize Reward StoryDL 500 SMemo 0 NTBWinComp 0 .%id%_win>
		.%id%_win <+T-- +F-->
	end


%%
%% *CS_CALoseMission Content
%%	&RevealEF	The enemy faction has been revealed
%%
%% Catch-all lose mission component.
%% The PC has lost a mission provided by the NPC. Note that the mission should not
%% have altered the state of the story; therefore, this reward is free to do so
%% itself.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Mission-giver
%%

Content
	name <Default Loss>
	desc <The NPC will debrief the PC on the loss.>
	requires <*CS_CALoseMission>

	% E1 is the NPC.

	start <if= PlotStatus %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %id% else %pop% gOTO .%id%_GoReportLoss>
		*.%id%_GoReportLoss <*MissionWasFailure .%id%_GoEnd &AllyFac &EnemyFac>
		.%id%_GoEnd <SMemo 0 NTBLoseComp 0 .%id%_loss>
		.%id%_loss <+T-- +F-->
	end

