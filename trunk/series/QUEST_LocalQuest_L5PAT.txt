%%
%%  *:Q_LocalQuest Content
%%
%% This file contains the quest frameworks for the cities of the L5 Region.
%%
%% The requires field should include *:LocalQuest and the designation of the
%% city to which this quest applies.
%%

Content
	name <Fuchal Spinner/CometBurger Sequence>
	requires <*:Q_LocalQuest "FUCSP">

	% E1 is CometBurger
	% E2 is Not CometBurger
	% E3 is the police officer
	% E4 is the food critic
	Element1 <Scene CometBurger>
	Element2 <Scene Building Public -CometBurger>
	Element3 <Prefab>
	Place3 <1 (Guards) sd ally>
	Element4 <Prefab>
	Place4 <2 (Citizens) pass ally>

	%% SubPlot1 is the initial CometBurger confrontation-
	%%       this one will determine which of the two NPCs the PC will get all remaining
	%%       missions from.
	%% SubPlot2 is the CometBurger extermination.
	%% SubPlot3 is the bit where we TAKE OVER THE WORLD!!!
	SubPlot1 <*Q_UNIQUE_FUCSP_Part1 #15 4 3 1>

	inv
		NPC Police Officer
		SetFaction 9

		NPC Cook
		Combatant
		CharDesc Criminal Passionate
		job <Food Critic>
		job_desig <ADVEN>
	end

Content
	name <Gaos Spinner/Galena Hodges>
	requires <*:Q_LocalQuest "GAOSP">

	% E1 is the hospital
	% E2 is Galena Hodges
	Element1 <Scene hospital public>
	Element2 <Prefab>
	Place2 <1 (Citizens) pass>

	%% P1 = Have negotiated a share of profits from Parshall

	Start <if= PlotStatus %plotid2% 0 else GoCheckSP3 ifG PCRenown 35 SetPlotStatus %plotid2% %id2%>
	GoCheckSP3 <if= PlotStatus %plotid3% 0 ifSubPlotWon %plotid% ifG PCRenown 60  SetPlotStatus %plotid3% %id3%>

	% SubPlot1 is the Galena Hodges/Money for Orphanage quest (15)
	% SubPlot2 is a side story (40)
	% SubPlot3 is the Prince Hotel party (65)
	SubPlot1 <*Q_UNIQUE_GAOSP_Galena #15 1 2>
	SubPlot2 <*:Q_SideStory #40>
	SubPlot3 <*:Q_UNIQUE_GAOSP_Parshall #65>

	sub
		MetaScene 2
		sub
			room
			desig <HOME>
			name <Office>
			minimap <.23.........1..#&+&##...#>
			inv
				STC BED-1
				PDir 2
				MiniMapComponent 2

				STC ENDTABLE-1
				PDir 2
				MiniMapComponent 3
			end
		end
	end
	inv
		NPC Doctor
		name <Galena Hodges>
		Age 98
		SetTeam 2
		Statline 7 6 8 13 18 16 23 12
		chardesc Female Heroic Heroic Heroic Sociable Spiritual
		SDL_PORTRAIT <>
		SDL_COLORS <90 150 80 199 188 162 190 210 230>
		SetTeam 2
		MiniMapComponent 1
	end

Content
	name <Xianxai Spinner/Trade Regulation>
	requires <*:Q_LocalQuest "XIASP">

	% E1 is the trade authority building
	% E2 is Matthias
	Element1 <Scene building public legit police>
	Element2 <Prefab>
	Place2 <1 (Guards) sd ally>

	%% P%id%01 = Initialization Counter
	%% Begin the Vesuvian Freighter task at Renown = 65
	start <ifSubPlotWon %plotid% ifG PCRenown 65 SetPlotStatus %plotid2% %id2%>
	update <if= P%id%01 0 P= %id%01 1 NPCLevel %2% 65>

	% SubPlot1 is the pirates/black market task
	% SubPlot2 is the Vesuvian Freighter task- activates at Renown 60 if 
	%       the PC won the previous task.
	SubPlot1 <*Q_UNIQUE_XIASP_Matthias #50 2>
	SubPlot2 <*:Q_UNIQUE_XIASP_Venus #75>

	sub
		Persona 2
		rumor0 <Matthias has his hands full dealing with all the pirate attacks we've had.>
		greeting <if= PlotStatus %plotid% 0 else GoChat NewChat Say 1 QMemo %plotid% 2 SetPlotStatus %plotid1% %id1%>
		GoChat <NewChat SayAnything>
		Msg1 <If you're planning to fly around outside the station, you should know that there have been a lot of pirate attacks recently. I'm offering a reward for anyone who can help get rid of them.>
		Msg2 <%name2% in %name1% told you that there's a reward for fighting pirates outside of the colony.>

		MetaScene 2
		sub
			room
			name <Office>
			special <HOME>
			minimap <2....1..............#&+##>
			inv
				STC TV
				MiniMapComponent 2
				PDir 1
			end
		end
	end
	inv
		NPC Police Officer
		name <Matthias>
		chardesc Male Lawful Shy Passionate Pragmatic Renowned
		SDL_PORTRAIT <por_m_serious(J--).png>
		SDL_COLORS <30 30 90 150 112 89 35 45 22>
		SetFaction 9
		Age 10
	end

Content
	name <Tohru Spinner/Reconstruction>
	requires <*:Q_LocalQuest "TOHSP">

	% E1 is Jiason Factory
	% E2 is McCabe
	% E3 is the urban scene
	% E4 is McCabe's building project
	% E5 is the new shopping center, opened when McCabe's quest succeeds
	% E6 is the mood for the shopping center opening
	Element1 <Scene building garage factory public>
	Element2 <Prefab>
	Place2 <1 (Guards) SD ally>
	Element3 <Scene Urban>
	Element4 <QuestScene>
	Place4 <3>
	Element5 <QuestScene>
	Place5 <4>
	Element6 <Prefab>

	%%  P1 = McCabe quest status
	%%       1: Have completed construction quest
	%%       2: Have opened the shopping center
	%%  P2 = Timer; shopping center opens after 24 hours

	start <if= PlotStatus %plotid1% 0 else GoCheckSP2 SetPlotStatus %plotid1% %id1%>
	GoCheckSP2 <if= PlotStatus %plotid2% 0 ifG PCRenown 30 SetPlotStatus %plotid2% %id2%>

	PUMPNEWS <if= P1 1 P+ 2 1 ifG P2 3  P= 1 2  SetMood %6% %3%>

	% SubPlot1 = McCabe's new building
	% SubPlot2 = Side Story
	SubPlot1 <*Q_UNIQUE_TOHSP_McCabe1 #10 2 4>
	SubPlot2 <*:Q_SideStory #30>

	sub
		Persona 2
		greeting <NewChat SayAnything>

		STC QS_ConstructionSite
		name <McCabe's Project>
		entrance <*BUILDING>
		SetID 4
		sub
			room
			minimap <............1............>
			inv
				TrapDoor
				MiniMapComponent 1
				Hide
				update <if= P1 2  SetStat STAT_MetaVisibility 0>
				desig <ENTRANCE %5%>
			end
		end

		MetaScene 5
		name <# Shopping Center>
		type <building mall meeting>
		MallMap
		MapWidth 23
		MapHeight 15
		start <Print 1>
		Msg1 <You enter \SCENE %5% .>
		NeededCells 4
		Content3 <Some 1 100 Sub *WEAPON_SHOP       na>
		Content4 <Some 1 100 Sub *ARMOR_SHOP        na>
		Content9 <Fill Sub *SHOP_RANDOM             na>
		sub
			team 1

			team 2
			name <Citizens>
			SetAlly 1
			Passive

			team 3
			name <Guards>
			SetAlly 2

			room
			name <Foyer>
			desig <EntranceGrid>
			Content <Some 3 50 Here *URBAN_X>
			Content2 <Some 1 100 Here *ANTI_ATTACK_SECURITY 2>
			sub
				StairsUp
				Destination -1
			end
		end
	end
	inv
		NPC Construction Worker
		name <McCabe>
		SetFaction 10
		SDL_PORTRAIT <por_f_allisonnewver(J--).png>
		SDL_COLORS <239 198 58  250 183 139  6 42 120>
		CharDesc Female Melancholy Easygoing Pragmatic Heroic
		Combatant
		Age 16

		Mood 5
		name <New Shopping Center>
		%% Essentially, this is a copy of the standard "Boom Times" mood.
		MoodTimeLimit 86400
		% V1 = Initialization Counter
		update <if= V1 0 V= 1 1 News 1>
		Msg1_1 <New shopping center opens in %city%.>
		% Meme Messages
		Msg_1 <McCabe's rebuilding project is starting to shape up. They've already opened the shops in the basement level.>
		CMsg_1 <if# ChatNPCID %2% if# SceneID %5% Accept>
		Msg_2 <Have you been to %name5% yet? They've got a lot of new shops there.>
		CMsg_2 <if# SceneID %5% Accept>
		Msg_3 <%name5% has opened for business. This is the first new building to open since the disaster.>
		Msg_4 <There are shops in the basement of the new building, now. You really ought to go check them out!>
		CMsg_4 <if# SceneID %5% Accept>
		Msg_5 <A shopping center has opened in the basement of the new building. Hopefully, the next thing they'll fix is that giant crack running across the sky.>
		CMsg_5 <if# SceneID %5% Accept>
	end


Content
	name <Cayley Rock/Old Wynter's Mine>
	requires <*:Q_LocalQuest "CAYLE">

	% E1 is the exterior scene
	% E2 is the mine entrance
	% E3 is Wynter's Mine
	% E4 is Lower Wynter's Mine
	% E5 is the blocked level
	% E6 is Cayley Caves
	% E7 is Cayley Core
	% E8 is the root scene
	% E9 is the disaster mood, following the earthquake
	Element1 <Scene Outdoors>
	Element2 <QuestScene>
	Place2 <1>
	Element3 <QuestScene>
	Place3 <2>
	Element4 <QuestScene>
	Place4 <3>
	Element5 <QuestScene>
	Place5 <4>
	Element6 <QuestScene>
	Place6 <5>
	Element7 <QuestScene>
	Place7 <6>
	Element8 <.>
	Element9 <Prefab>

	% P1 = Elevator Repair Counter (From main building to mine bottom)
	%      0: Broken, 1: Repaired
	% P2 = Initialization Counter

	% Activate the Wynter's Mine and Lower Wynter's Mine quests right away.
	update <if= P2 0 P= 2 1 SetPlotStatus %plotid1% %id1% SetPlotStatus %plotid2% %id2%>

	% Activate the lower quests some time after the PC reaches Renown 50.
	PUMPNEWS <if= PlotStatus %plotid3% 0  ifG PCRenown 50  if= d8 1  SetPlotStatus %plotid3% %id3% SetPlotStatus %plotid4% %id4% SetMood %9% %8% if= RootSceneID %8% Goto GoEarthQuake>
	GoEarthQuake <Alert 1 History 2 Stamina Mental>

	Msg1 <All of a sudden, the ground shakes with incredible force!>
	Msg2 <You were on Cayley Rock when an earthquake occurred.>

	% SubPlot1 = Wynter's Mine Quest
	% SubPlot2 = Lower Wynter's Mine Quest
	% SubPlot3 = Cayley Caves Quest
	% SubPlot4 = Cayley Core Quest
	SubPlot1 <*:Q_DungeonQuest #10 3>
	SubPlot2 <*:Q_DungeonQuest #30 4>
	SubPlot3 <*:Q_Unique_CAYLE_Caves #55 6>
	SubPlot4 <*:Q_Unique_CAYLE_Core #85 7>

	sub
		MetaScene 2
		name <Old Wynter's Mine>
		type <building ruin mine !Ne open>
		terrain <SPACE>
		habitat <SPACE.ASTER>
		entrance <*Building>
		MonkeyMap
		MapWidth 21
		MapHeight 21
		special <AddExit>
		IndustrialTiles

		NeededCells 1
		content <Some 1 100 Sub *DUNGEON_DECOR>

		% V1 = First time entry indicator.

		Start <if= V1 0 else GoBeenBefore V= 1 1 Print 2 Alert 1>
		GoBeenBefore <Print 2>

		Msg1 <This old building was obviously abandoned some time ago. The power generator still works on this upper level, and the air seems breathable enough.>
		Msg2 <You enter Old Wynter's Mine.>

		sub
			Team 1
			SetEnemy 2

			Team 2
			name <Monster>
			type <Mine Fungus Asteroid>
			SetEnemy 1

			room
			sub
				trapdoor
				desig <ENTRANCE %3%>
				use <if= StatVal STAT_Lock 0 else GoLocked if= V1 1 else GoFirstTime Print 1 Exit StatVal 4>
				GoFirstTime <ifYesNo 101 102 103  V= 1 1  Print 1 Exit StatVal 4 MonsterUp 2 10>
				Msg101 <This is an airlock. There's still power here, but no guarantee there will be power in the mines.>
				Msg102 <Enter the mine.>
				Msg103 <Don't enter the mine.>
			end

			room
			minimap <......###..#1#...........>
			inv
				elevator
				desig <ENTRANCE %5%>
				MiniMapComponent 1
				use <if= P1 1 else GoBroken Print 1 Exit Destination>
				GoBroken <Print 101>
				CLUE_REPAIR <if= P1 0 else GoWorking ifRepair HardSkillTar 50 else GoRepairFail Mental Print 104 XPV 50 P= 1 1>
				CLUE_INSIGHT <if= P1 0 else GoWorking Print 103>
				GoRepairFail <Print 103>
				GoWorking <Print 102>
				Msg101 <This elevator isn't working.>
				Msg102 <You can't find any damage to fix.>
				Msg103 <The problem with this elevator appears to be at the other end.>
				Msg104 <You repair the elevator. It should be usable now.>
			end
		end

		STC QS_Dungeon_AsteroidMine
		SetID 3
		name <Wynter's Mine>
		DifficultyLevel 10

		STC QS_Dungeon_AsteroidMine
		SetID 4
		name <Lower Wynter's Mine>
		entrance <*GoDown>
		DifficultyLevel 30

		STC QS_Dungeon_AsteroidMine
		SetID 5
		name <Wynter's Mine Bottom>
		type <asteroid mine>
		entrance <*GoDown>
		DifficultyLevel 40
		sub
			Room
			minimap <......###..#1#...... ... >
			width 5
			height 5
			inv
				Elevator
				desig <ENTRANCE %2%>
				MiniMapComponent 1
				use <if= P1 0 else GoAlreadyWorking ifYesNo 101 102 103 Print 104 Stamina P= 1 1 XPV 50>
				GoAlreadyWorking <Print 1 Exit Destination>
				CLUE_REPAIR <if= P1 0 else GoNoDamage Print 106>
				GoNoDamage <Print 105>
				CLUE_INSIGHT <Print 107>
				Msg101 <This elevator has been clogged by debris.>
				Msg102 <Clean it out.>
				Msg103 <Leave it alone.>
				Msg104 <You clean out the elevator. It should be usable now.>
				Msg105 <You can't find any damage to fix.>
				Msg106 <The only way to repair this elevator is to clear out the rubble.>
				Msg107 <This elevator probably connects to the one in the minehouse above.>
			end

			Room
			width 5
			height 5
			sub
				StairsDown
				desig <ENTRANCE %6%>
				use <if# PlotStatus %plotid3% 0 else GoBlocked Print 1 Exit Destination>
				GoBlocked <Print 2>
				CLUE_REPAIR <Print 3>
				CLUE_SURVIVAL <Print 3>
				CLUE_SCIENCE <Print 3>
				CLUE_INSIGHT <Print 3>
				CLUE_MYSTICISM <Print 4>
				Msg2 <This passage is blocked by rubble. You can't get through.>
				Msg3 <There's no way through. You'd need a Haiho to move that rubble.>
				Msg4 <You have a premonition that something truly unnatural lies buried behind this rubble.>
			end
		end

		STC QS_Dungeon_AsteroidCave
		SetID 6
		name <Cayley Caves>
		DifficultyLevel 65
		sub
			Team 3
			name <Exorg>
			SetAlly 2
			SetEnemy 1

			room
			%% The expansion generator
			width 5
			height 5
			ForEntryLevel
			minimap < %%% %%^&%^%1&%^%%^% %^% >
			inv
				STC MACHINE-1
				% V1 = Science XP counter
				% V2 = Insight XP counter
				MiniMapComponent 1
				name <Destroyed Machine>
				use <Print 1>
				CLUE_SCIENCE <if= V1 0 else GoSciBefore ifScience HardSkillTar 65 else GoSciFail Alert 2 Alert 3 XPV 100 SkillXP NAS_Science 500 V= 1 1>
				GoSciBefore <Print 2>
				GoSciFail <Print 4>
				CLUE_REPAIR <Print 5>
				CLUE_INSIGHT <if= V2 0 else GoInsightBefore ifInsight SkillTar 60 else GoInsightFail Alert 6 Alert 7 V= 2 1 XPV 100>
				GoInsightBefore <Print 6>
				GoInsightFail <Print 4>
				CLUE_MYSTICISM <Print 8>
				Msg1 <You stand within the wreckage of a huge machine.>
				Msg2 <This appears to be the wreckage of an expansion generator, a theoretical construct needed to generate a subspace pocket for a faster than light engine.>
				Msg3 <As far as you know, nobody in this solar system is even close to building one.>
				Msg4 <You can't figure out what this machine might have been for.>
				Msg5 <Repairing this device is beyond your skill level. You suspect that it's beyond anyone's skill level.>
				Msg6 <Judging by the surroundings, the explosion of this machine may have been the cause of the Cayley earthquake.>
				Msg7 <Inexplicably, the core of the machine is practically undamaged.>
				Msg8 <The core of this destroyed machine has an otherworldly feel to it.>
			end
		end

		STC QS_Dungeon_AsteroidCave
		SetID 7
		name <Cayley Core>
		entrance <*GoDown>
		DifficultyLevel 85
	end
	inv
		Mood 2
		name <Cayley Earthquake Mood>
		plot_type <*Disaster>
		MoodTimeLimit
		% V1 = Initialization Counter
		Update <if= v1 0 V= 1 1   News 1>
		Msg1_1 <Disaster in %city% as station is rocked by mysterious quake.>
		Msg1_2 <Technocrats say swamp gas responsible for %city% earthquake.>
		% Meme Messages
		Msg_1 <It's a wonder more people weren't killed when the quake hit.>
		Msg_2 <In all the time I've been living here, we've never had an earthquake until now.>
		Msg_3 <I wonder if there's going to be another earthquake, later on...?>
		Msg_11 <Why do you think the earthquake happened? I heard that it may have been a meteor collision.>
		CMsg_11 <ifNPCSociable Accept>
		Msg_12 <I'm still shaken up...>
		CMsg_12 <ifNPCShy Accept>
		Msg_13 <I thought earthquakes were only supposed to happen on planets, but I guess I was wrong.>
		CMsg_13 <ifNPCEasygoing Accept>
		Msg_14 <The earth moved! It was incredible!>
		CMsg_14 <ifNPCPassionate Accept>
		Msg_15 <Were you here when the earthquake hit? It was the most exciting thing to happen in Cayley Rock for ages.>
		CMsg_15 <ifNPCCheerful Accept>
		Msg_16 <I heard someone claim that the mines are collapsing. If the rock breaks up, we're all going to be in a lot of trouble.>
		CMsg_16 <ifNPCMelancholy Accept>
	end



