%%
%% *CS_ThanksForAssist
%%
%% The PC didn't exactly rescue this NPC, but he did assist.
%%
%% PARAM1: The NPC who was aided.
%%

Plot
	name <I've got info for you.>
	desc <The NPC will tell the PC a secret.>
	requires <*CS_ThanksForAssist>

	% Element1 is the NPC to meet

	start <if= PlotStatus %plotid% %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	% SubPlot1 is a revelation
	SubPlot1 <*CS_Revelation&Friendly 1>

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop% NewChat Say %id%01 AddChat %id%01>
		result%id%01 <Goto %id1%_GoInit>
		Msg%id%01 <Thanks for your help back there. You know, I've got some information that you just might find useful.>
		Msg%id%01_1 <>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <>
		CMsg%id%01_3 <ifNPCCheerful Accept>
		Msg%id%01_4 <>
		CMsg%id%01_4 <ifNPCMelancholy Accept>
		Msg%id%01_5 <>
		CMsg%id%01_5 <ifNPCEasygoing Accept>
		Msg%id%01_6 <>
		CMsg%id%01_6 <ifNPCPassionate Accept>
		Prompt%id%01 <Tell me what it is.>
		Prompt%id%01_1 <Really? Great.>
		Prompt%id%01_2 <Go on, then. Don't leave me waiting.>
	end

%%
%% *CS_Pla_GetItem
%%	&Derelict	The item was found in a wreck
%%
%% In the +Pla plot state, the PC is about to come into posession of the
%% target item. This subplot will add some consequences for this; Note that
%% this may also be triggered if the target item is destroyed or otherwise
%% lost. Make sure you check for that, too.
%%
%% PARAM1: The item obtained.
%%

Content
	name <Do Not Want>
	desc <The enemy didn't want the artifact; he wanted the info from the derelict's computer.>
	requires <*CS_Pla_GetItem &Derelict E:++ F:++>
	Size 3

	% E1 is the item obtained
	% E2 is the enemy character
	Element2 <Grab 1>
	Place2 </>

	% P%id%01 = Message counter

	start <if= PlotStatus %plotid% %id% else %pop% ifScene .%id%_Scene if= P%id%01 0 P= %id%01 1 ForceChat %2%>
	.%id%_Scene <OUTDOORS>

	sub
		Persona 2
		special <UNLISTED NOESCAPE>
		greeting <EndChat Say 1 AddChat 1>
		result1 <EndChat Say 2 StoryNote 3 Print 4 &SetTargetItem 0 WinComp 0 .next  SavePos Dynamic 2 StoryDL 100 .nu1 .nu2 DynaFaction &EnemyFac>
		.next <+Pew +T-- +F-->
		.nu1 <if= T1 0  Return   if= L2 0  L= 2 1  AddRenown -5>
		.nu2 <if= T2 0           if= L2 0  L= 2 1  XPV 100  AddRenown 1   Return>
		Msg1 <\PC , I should have expected to find you here. Well, it hardly matters- you're too late to stop me.>
		Msg2 <It wasn't the %name1% that I was after- it was the computer on board the ship that was carrying it. This information will be a great help to our new weapons program. Unfortunately, you will not live to see the glorious rise of \FACTION &EnemyFac !>
		Msg3 <%name2% revealed that \FACTION &EnemyFac were working on a new weapons program.>
		Msg4 <You are attacked by %name2%'s men.>
		Prompt1 <Too late? I beat you to the %name1%!>
	end


%%
%% *CS_DelayedVictory Content
%% *CS_DelayedNegation Content
%%
%% Victory is going to be delayed for several hours. This subplot is generally used when
%% a mission-giver asks the PC to go relax for a while before the next mission.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%% Before calling this subplot, the story status must have been set with AlterContext.
%%

Content
	name <Default Delay>
	desc <Several hours will pass before the next component is generated.>
	requires <*CS_DelayedNegation>

	% P%id%01 = Time Limit
	update <if= PlotStatus %plotid% %id% else %pop% if= P%id%01 0 P= %id%01 ComTime P+ %id%01 7200 P+ %id%01 d86400>
	hour <if= PlotStatus %plotid% %id% else %pop% ifG ComTime P%id%01 NegateComp &CompScene na>

Content
	name <Default Delay>
	desc <Several hours will pass before the next component is generated.>
	requires <*CS_DelayedVictory>

	% P%id%01 = Time Limit
	update <if= PlotStatus %plotid% %id% else %pop% if= P%id%01 0 P= %id%01 ComTime P+ %id%01 7200 P+ %id%01 d86400>
	hour <if= PlotStatus %plotid% %id% else %pop% ifG ComTime P%id%01 WinComp &CompScene na>


%%
%% *CS_FriendFired_Win Content
%%
%% The PC's friend has just been fired from a faction, and for whatever reason this
%% is a win for the PC.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The NPC who has been fired
%% Param2: The faction he's been fired from
%%

Content
	name <What did I do?>
	desc <The friend wonders what he did wrong.>
	requires <*CS_FriendFired_Win>

	% E1 is the friend
	% E2 is the faction he's been fired from
	% E3 is a public scene for the meeting
	Element3 <Scene Building Public !NEar -7>

	% p%id%01 = Initialization Counter
	start <if= PlotStatus %plotid% %id% else %pop% ifNPCDead %1% LoseComp 0 .%id%_Next>
	.%id%_Next <+T-- +G-->
	update <if= PlotStatus %plotid% %id% else %pop% if= P%id%01 0 P= %id%01 1 MoveAndPacifyNPC %1% %3% SetNPCFaction %1% 0 Email %id%01>

	Msg%id%01_1 <%name1%@ \NARRATIVE 7 :// I've received bad news from %name2%... come meet me in %name3%.>
	Msg%id%01_2 <%name1%@ \NARRATIVE 7 :// I've got some bad news. Come see me in %name3%.>
	Msg%id%01_3 <%name1%@ \NARRATIVE 7 :// This has been a terrible day... I'd like to talk with you in %name3%.>

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop% NewChat Say %id%01 NTBWinComp 0 .%id%_next StoryNote %id%03 AddChat %id%01 AddChat %id%02>
		.%id%_next <+T-- +F-->
		result%id%01 <NewChat Say %id%02  AddCheerful d6>
		result%id%02 <NewChat Say %id%02>
		Msg%id%01 <I don't understand what happened; I've been fired from %name2%.>
		Msg%id%01_1 <I have some terrible news... I've been fired from %name2%. I don't know why, but they told me to go and never come back.>
		Msg%id%01_2 <I've been fired from %name2%. It was really a shock... I thought I was doing so well.>
		Msg%id%02 <I know I'll find something else in time, but for right now I'm feeling very disappointed.>
		Msg%id%02_1 <The worst part is, I made a lot of new friends while at %name2%. I guess maybe I'll see them again, but I don't know...>
		CMsg%id%02_1 <ifNPCSociable Accept>
		Msg%id%02_2 <I think I probably will do better by myself. I was never much of a joiner, anyhow.>
		CMsg%id%02_2 <ifNPCShy Accept>
		Msg%id%02_3 <Eh, it's not that bad. I'll find something else, or I won't... either way is fine.>
		CMsg%id%02_3 <ifNPCEasygoing Accept>
		Msg%id%02_4 <Those idiots at %name2% don't know what they're doing! I don't need them! I can do better by myself!>
		CMsg%id%02_4 <ifNPCPassionate Accept>
		Msg%id%02_5 <You know, I had been looking at this like an ending, but instead I think it's a beginning. Now that I'm free from %name2% I can choose my own destiny, wherever that may lead.>
		CMsg%id%02_5 <ifNPCCheerful Accept>
		Msg%id%02_6 <I guess I'm just not good enough to make it as a member of %name2%... I'll have to learn to accept that.>
		CMsg%id%02_6 <ifNPCMelancholy Accept>
		Msg%id%03 <%name1% was fired from %name2%, much to your relief.>
		Prompt%id%01 <It's probably for the best.>
		Prompt%id%01_1 <You're better off without them.>
		Prompt%id%01_2 <You're too good to work for them, anyhow.>
		Prompt%id%02 <Oh, that's too bad... I wonder what happened.>
		Prompt%id%02_1 <How surprising... I wonder what happened.>
		Prompt%id%02_2 <That's a shame... I wonder what happened.>
	end


%%
%% *ForcedInduction Content
%%
%% The PC has been forced into the ranks of the target faction against his will.
%% This component will move the PC to a induction location, alter the plot state,
%% store the PC's current faction and set the new faction. The new propp state
%% will be "+Psh".
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The NPC doing the induction
%% Param2: The faction the PC will be inducted into
%%

Content
	name <Induction Plus Mission>
	requires <*ForcedInduction>
	desc <You are forcibly inducted into a faction and told to report for a mission.>

	% Element1 is the NPC doing the induction
	% Element2 is the faction the PC will be inducted into
	% Element3 is the scene where the induction will take place
	% Element4 is the NPC you must report to
	Element3 <Scene Building Public !Near -7 !Ally 2>
	Element4 <Character !Ally 2 !Near -7>

	% v%id%01 = Initialization/Conversation Counter

	update <if= PlotStatus %plotid% %id% else %pop% if= v%id%01 0 V= %id%01 1 Exit %3% MoveAndPacifyNPC %1% %3% MoveNPC %4% %3%>

	start <if= v%id%01 1 else %pop% Alert %id%01 ForceChat %1% V= %id%01 2 Goto %pop%>
	Msg%id%01 <You are taken to %name3%.>

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop%  &SetAllyFac %2% StoreOldFaction SetPCFac %2% &SetTargetNPC %4% NegateComp %3% .%id%_next  StoryNote %id%02 Goto .%id%_GoGreet>
		*.%id%_GoGreet <*CS_ForcedInduction_Greeting .%id%_GoBrief %2%>
		.%id%_next <+Tgt +Fmi +Psh>
		.%id%_GoBrief <ifNPCOK %4% else .%id%_GoScrapMission NewChat Say %id%01 SMemo %id%04>
		.%id%_GoScrapMission <NewChat Say %id%03 AlterContext .%id%_ScrapContext>
		.%id%_ScrapContext <+T-- +F-->
		Msg%id%01 <Go talk with %name4% for your first mission; \SPR %4% should be somewhere in this building.>
		Msg%id%01_1 <You have to speak with %name4% about your first mission. I believe \SPR %4% can be found somewhere in this building.>
		Msg%id%01_2 <%name4% has the details of your first mission. You'll need to go talk with \OPR %4% right over there.>
		Msg%id%02 <You were conscripted into %name2%.>
		Msg%id%03 <There was a task planned for you, but I'm afraid it's been scrapped. I'll let you know when there's something for you to do.>
		Msg%id%04 <You have to see %name4% in %name3% about your first mission for %name2%.>
	end

Content
	name <Basic Induction>
	requires <*ForcedInduction>
	desc <You are forcibly inducted into a faction, but given no orders at this time.>

	% Element1 is the NPC doing the induction
	% Element2 is the faction the PC will be inducted into
	% Element3 is the scene where the induction will take place
	Element3 <Scene Building Public !Near -7 !Ally 1>

	% v%id%01 = Initialization/Conversation Counter

	update <if= PlotStatus %plotid% %id% else %pop% if= v%id%01 0 V= %id%01 1 Exit %3% MoveAndPacifyNPC %1% %3%>

	start <if= v%id%01 1 else %pop% Alert %id%01 ForceChat %1% V= %id%01 2 Goto %pop%>
	Msg%id%01 <You are taken to %name3%.>

	% The only subplot is a delay before the next mission.
	SubPlot1 <*CS_DelayedNegation>

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop%  &SetAllyFac %2% StoreOldFaction SetPCFac %2% &SetCompScene 0 AlterCOntext .%id%_next SetPlotStatus %plotid% %id1%  StoryNote %id%02 Goto .%id%_GoGreet>
		*.%id%_GoGreet <*CS_ForcedInduction_Greeting .%id%_GoBrief %2%>
		.%id%_next <+T-- +F-- +Psh>
		.%id%_GoBrief <NewChat Say %id%01>
		Msg%id%01 <We'll let you know when there's some work that needs to be done. For the time being you're free to go.>
		Msg%id%01_1 <For the time being you're free to do whatever you'd like. I'll let you know when it's time for your first mission.>
		Msg%id%01_2 <You are free to go, for the moment. I'll call you back when we have a mission for you.>
		Msg%id%02 <You were conscripted into %name2%.>
	end

Content
	name <Secret Base Induction>
	requires <*ForcedInduction>
	desc <You are forcibly inducted into a faction, but given no orders at this time.>

	% Element1 is the NPC doing the induction
	% Element2 is the faction the PC will be inducted into
	% Element3 is an urban scene for the secret base
	% Element4 is the secret base
	Element3 <Scene Urban !Near -7>
	Element4 <Prefab>
	Place4 <3>

	% v%id%01 = Initialization/Conversation Counter

	update <if= PlotStatus %plotid% %id% else %pop% if= v%id%01 0 V= %id%01 1 Exit %4% MoveAndPacifyNPC %1% %4%>

	start <if= v%id%01 1 else %pop% Alert %id%01 ForceChat %1%  V= %id%01 2  Goto %pop%>
	Msg%id%01 <You are taken to a secret base of %name2%.>

	% The only subplot is a delay before the next mission.
	SubPlot1 <*CS_DelayedNegation>

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop%  &SetAllyFac %2% StoreOldFaction SetPCFac %2% &SetCompScene 0 AlterCOntext .%id%_next SetPlotStatus %plotid% %id1%  StoryNote %id%02 Goto .%id%_GoGreet>
		*.%id%_GoGreet <*CS_ForcedInduction_Greeting .%id%_GoBrief %2%>
		.%id%_next <+T-- +F-- +Psh>
		.%id%_GoBrief <NewChat Say %id%01>
		Msg%id%01 <We'll let you know when there's some work that needs to be done. For the time being you're free to go.>
		Msg%id%01_1 <For the time being you're free to do whatever you'd like. I'll let you know when it's time for your first mission.>
		Msg%id%01_2 <You are free to go, for the moment. I'll call you back when we have a mission for you.>
		Msg%id%02 <You were conscripted into %name2%.>

		STC MS_Office
		SetID 4
	end
	inv
		STC ENCOUNTER-WANDER
		name <Secret Base>
		update <if= PlotStatus %plotid% %id% else GoHide SetStat STAT_MetaVisibility 0  Goto GoSetOrders>
	end

%%
%% *CS_WinDuelVs Content
%%
%%
%% The PC has won a duel against the NPC.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Challenger
%%

Content
	name <You should go see MILIT...>
	desc <The NPC will reccomend that the PC go ask someone about a job.>
	requires <*CS_WinDuelVs -L:ENEMY -C:THIEF>

	% E1 is the NPC.
	% E2 is the person to see about the job
	% E3 is a public scene for the meeting.
	Element2 <Character "MILIT" !Near -7 !Ally -7 !Okay -3 !Okay 1>
	Element3 <Scene Building Public !Near -7 !Ally 2>

	start <if= PlotStatus %plotid% %id% else %pop% ifNPCDead %1% SMemo 0 WinComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop% ifNPCOK %2% else .%id%_GoE2Died NewChat Say %id%01 SMemo %id%02 &SetTargetNPC %2% WinComp %3% .%id%_win>
		.%id%_GoE2Died <NewChat Say %id%03 SMemo 0 WinComp 0 .%id%_draw>
		.%id%_win <+Tgt +Fmi>
		.%id%_draw <+T-- +F-->
		Msg%id%01 <You beat me. You should go talk with %name2% in %name3%; I hear that \SPR %2% 's looking for a good pilot.>
		Msg%id%01_1 <You won our duel. A fighter with your talents could really go places... I hear that %name2% is looking for a pilot over at %name3%. You should go talk with \OPR %2% .>
		CMsg%id%01_1 <ifNPCSociable Accept>
		Msg%id%01_2 <Good match. I've got a tip for you- %name2% in %name3% is looking for a mecha pilot. You should definitely check it out.>
		CMsg%id%01_2 <ifNPCShy Accept>
		Msg%id%01_3 <You did half decent out there, I thought. If you're interested I know of a job opening. %name2% in %name3% needs a pilot. Tell \OPR %2% I sent you.>
		CMsg%id%01_3 <ifNPCEasygoing Accept>
		Msg%id%01_4 <You've shown me the true art of fighting. I was going to go to %name3% and do a mission for %name2% , but you should go instead. You've proven yourself the better pilot.>
		CMsg%id%01_4 <ifNPCPassionate Accept>
		Msg%id%01_5 <That was a great fight. I've got a tip for you- %name2% in %name3% is looking for a pilot. You've proven yourself capable, I think you could get the job.>
		CMsg%id%01_5 <ifNPCCheerful Accept>
		Msg%id%01_6 <I can't believe I lost to you... I was supposed to run a mission for %name2% at %name3% today, but now that my mecha's in the shop I can't. If you wanted you could go take the mission yourself.>
		CMsg%id%01_6 <ifNPCMelancholy Accept>
		Msg%id%02 <%name1% reccomended that you go ask %name2% in %name3% for a mission.>
		Msg%id%03 <You won the duel. Congratulations.>
	end

%%
%% *CS_LoseDuelVs Content
%%
%%
%% The PC has lost a duel against the NPC.
%%
%% The parent plot sets the plot status to this layer's ID when ready.
%%
%% Param1: The Challenger
%%

Content
	name <Job Advice>
	desc <The NPC will suggest the PC go ask someone for a job.>
	requires <*CS_LoseDuelVs ~1:FRIEND ~1:PDASS ~P:-- -L:ENEMY>

	% E1 is the NPC.
	% E2 is the person to ask about the job.
	% E3 is a scene for the meeting.
	Element2 <Character !Ally -7 !Near -7>
	Element3 <Scene Building Public !Near -7 !Okay 2>

	start <if= PlotStatus %plotid% %id% else %pop% ifNPCDead %1% SMemo 0 LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop% ifNPCOK %2% else .%id%_GoTrivial NewChat Say %id%01 SMemo %id%02 History %id%03 &SetTargetNPC %2% LoseComp %3% .%id%_changes>
		.%id%_GoTrivial <NewChat Say %id%04 SMemo 0 NTBLoseComp 0 .%id%_loss>
		.%id%_changes <+Tgt +Fmi>
		.%id%_loss <+T-- +F-->
		Msg%id%01 <Hey, don't be disappointed about losing, you tried your best. Here's something that might cheer you up- I hear that %name2% is looking to hire a cavalier. If you get over to %name3% right away maybe you could get the job.>
		Msg%id%02 <After beating you in a duel, %name1% reccomended that you ask %name2% at %name3% for a job.>
		Msg%id%03 <%name1% reccomended that you ask %name2% for a job.>
		Msg%id%04 <You lost the duel. Good for me.>
	end

Content
	name <Ha ha!>
	desc <The NPC will just chide the PC, then end the plot.>
	requires <*CS_LoseDuelVs>

	% E1 is the NPC.

	start <if= PlotStatus %plotid% %id% else %pop% ifNPCDead %1% SMemo 0 LoseComp 0 .%id%_loss>
	.%id%_loss <+T-- +F-->

	sub
		Persona 1
		greeting <if= PlotStatus %plotid% %id% else %pop% NewChat Say %id%01 SMemo 0 NTBLoseComp 0 .%id%_changes>
		.%id%_changes <+T-- +F-->
		Msg%id%01 <You lost the duel. Good for me.>
	end

