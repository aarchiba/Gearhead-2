%%
%%  *:Q_DungeonQuest Content
%%
%% A dungeon is a dangerous place filled with monsters. We give them dungeon
%% quests in order to prevent them from being boring.
%%
%%
%%  PARAM1: The dungeon involved
%%

Content
	name <Artifact Recovery>
	requires <*:Q_DungeonQuest>

	% E1 is the dungeon involved
	% E2 is a local public scene
	% E3 is a professor who is looking for an artifact
	% E4 is the artifact being sought
	Element2 <Scene Public (Building|Meeting|School)>
	Element3 <Prefab>
	Place3 <2 (Citizens) pass ally>
	Element4 <Artifact PreZero>

	% P%id%01 = Initialization Counter
	% P%id%02 = Have accepted quest

	%% FAIL CONDITIONS:
	%% - E4 gets destroyed
	%% - E3 dies

	update <if= P%id%01 0 P= %id%01 1 MoveItem %4% %1%>
	end <ifItemDestroyed %4% else .%id%_GoCheckDeath if= P%id%02 0 else .%id%_GoFailTask CancelSubPlot %plotid%>
	.%id%_GoFailTask <SetPlotStatus %plotid2% %id2%>
	.%id%_GoCheckDeath <ifNPCDead %3% CancelSubPlot %plotid%>

	% If the PC gets the item, call the Win Fetch subplot.
	Get%4% <if= P%id%02 1 else .%id%_GoFetchNoMission SetPlotStatus %plotid1% %id1%>
	.%id%_GoFetchNoMission <SetPlotStatus %plotid3% %id3%>

	% SubPlot1 is the win fetch quest.
	% SubPlot2 is the task lost quest.
	% SubPlot3 is the didn't-accept-quest-but-fetched-anyways bit.
	SubPlot1 <*Q_WinFetchItem 3 4>
	SubPlot2 <*Q_LoseTask 3>
	SubPlot3 <*Q_FetchWantedItem 3 4>

	sub
		Persona 3
		rumor%id% <%name3% has been trying to locate the %name4%.>
		greeting <if= PlotStatus %plotid% %id% else %pop% if= P%id%02 0 else .%id%_GoRemind Goto .%id%_GoGreet>
		*.%id%_GoRemind <*GenericMissionReminder>
		*.%id%_GoGreet <*AreYouHereAboutJob .%id%_GoBriefing>
		.%id%_GoBriefing <NewChat Say %id%01 AddChat %id%01 AddChat %id%02 AddChat %id%03>
		result%id%01 <NewChat Say %id%02 AddChat %id%04 AddChat %id%05 AddChat %id%06>
		*result%id%02 <*RejectMission .%id%_GoR2Exit>
		.%id%_GoR2Exit <AddReact -10   CancelSubPlot %plotid%>
		result%id%03 <NewChat Say %id%03 AddChat %id%04 AddChat %id%05 AddChat %id%06>
		result%id%04 <NewChat Say %id%04 QMemo %plotid% %id%05 P= %id%02 1>
		result%id%05 <Goto result%id%02>
		result%id%06 <NewChat Say %id%06 XPV 100 QMemo %plotid% %id%05 P= %id%02 1>
		Msg%id%01 <I've been searching for an artifact known as the %name4%. My research has led me to conclude that it is nearby, but I am unable to reach it myself.>
		Msg%id%02 <Yes, exactly. You will be handsomely rewarded for your efforts, of course.>
		Msg%id%03 <\ITEM_DESC %4% \ITEM_HISTORY %4% If you recover it, I can continue my research.>
		Msg%id%04 <The %name4% was last seen in %name1%. That's where I would begin searching, were I you.>
		Msg%id%05 <%name3% in %name2% hired you to recover the %name4% from %name1%.>
		Msg%id%06 <Co-authorship!? Very well, I can't write the paper at all if I don't have the %name4%... According to historical records the %name4% was last seen in %name1%. That's where I would begin searching, were I you.>
		Prompt%id%01 <So you want me to get it for you?>
		Prompt%id%02 <This doesn't sound like my kind of mission.>
		Prompt%id%03 <What can you tell me about this %name4%?>
		Prompt%id%04 <Alright, I'll return to you when I've found it.>
		Prompt%id%05 <Sorry, I don't want this job.>
		Prompt%id%06 <Okay, but I want co-authorship on the research paper.>
		CPrompt%id%06 <ifSkillTest NAS_Science STAT_Ego SkillTar %threat% Accept>
	end
	inv
		NPC Professor
	end


